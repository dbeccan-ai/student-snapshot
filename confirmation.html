<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Snapshot Confirmation | D.E.Bs Learning Academy</title>
  <style>
    :root{
      --bg:#6c67c9;
      --bg-dark:#5e58be;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --line:#dbe4f2;
      --bar:#6b63c6;
      --bar-dark:#544db4;
      --accent:#ffde59;
      --radius:10px;
      --radius2:8px;
      --shadow:0 18px 45px rgba(0,0,0,.22);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--font);
      background: linear-gradient(180deg, var(--bg) 0%, var(--bg-dark) 100%);
      color:var(--ink);
      min-height:100vh;
      padding: 24px 12px 60px;
    }
    .container{ max-width: 760px; margin: 0 auto; }
    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.05);
    }
    .head{
      padding: 18px 18px 10px;
      text-align:center;
      position: relative;
    }
    .lang{
      position:absolute;
      right: 12px;
      top: 12px;
      display:flex;
      gap:8px;
      align-items:center;
      font-size: 12px;
      color: var(--muted);
    }
    .lang select{
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 800;
      font-size: 12px;
      background:#fff;
      cursor:pointer;
    }
    @media (max-width: 720px){
      .lang{ position: static; justify-content: center; margin-bottom: 10px; }
    }
    .head h1{ margin:0; font-size: 18px; font-weight: 900; letter-spacing: .2px; }
    .head .sub{ margin: 6px 0 0; font-size: 12px; color: var(--muted); }

    .content{ padding: 12px 14px 16px; }

    .section{
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      margin-bottom: 12px;
      overflow:hidden;
      background:#fff;
    }
    .section-title{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--bar) 0%, var(--bar-dark) 100%);
      color:#fff;
      font-weight: 900;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .badge{
      width:18px;height:18px;
      border-radius:4px;
      background: rgba(255,255,255,.18);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size: 11px;
      font-weight: 900;
    }
    .section-body{ padding: 12px; }
    .row{ display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .kv{ min-width: 220px; flex:1; padding: 8px 10px; border:1px solid var(--line); border-radius: 8px; background:#fbfcff; }
    .k{ font-size:11px; font-weight:900; color:#334155; margin-bottom:4px; }
    .v{ font-size:12px; color:#0f172a; white-space:pre-wrap; }
    .list{ margin:0; padding-left: 18px; }
    .muted{ color: var(--muted); font-size: 12px; }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding: 0 14px 16px;
    }
    .btn{
      border:0;
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      font-weight: 900;
      font-size: 12px;
    }
    .btn.primary{
      background: linear-gradient(180deg, var(--bar) 0%, var(--bar-dark) 100%);
      color:#fff;
    }
    .btn.secondary{
      background: #f1f5ff;
      color:#1f2a44;
      border: 1px solid var(--line);
    }
    .btn.accent{
      background: var(--accent);
      color:#111827;
    }

    a.link{ color:#1f2a44; font-weight:900; text-decoration:none; }
    a.link:hover{ text-decoration:underline; }

    @media print{
      body{ background:#fff; padding:0; }
      .actions, .lang{ display:none !important; }
      .card{ box-shadow:none; border-radius:0; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="head">
        <div class="lang">
          <span data-i18n="langLabel">Language</span>
          <select id="langSelect" aria-label="Language">
            <option value="en">English</option>
            <option value="es">EspaÃ±ol</option>
            <option value="fr">FranÃ§ais</option>
            <option value="zh">ä¸­æ–‡</option>
          </select>
        </div>

        <h1 data-i18n="confirmTitle">âœ… Snapshot Saved</h1>
        <div class="sub" data-i18n="confirmSub">Your answers are saved on this device. Use the buttons below to Print/Save as PDF or Download.</div>
      </div>

      <div class="content" id="renderArea">
        <div class="section">
          <div class="section-title"><span class="badge">A</span> <span data-i18n="secA">ğŸ‘§ğŸ½ğŸ“˜ Student Information</span></div>
          <div class="section-body">
            <div class="row">
              <div class="kv"><div class="k" data-i18n="studentName">Student Name:</div><div class="v" id="v_studentName">â€”</div></div>
              <div class="kv"><div class="k" data-i18n="grade">Grade:</div><div class="v" id="v_grade">â€”</div></div>
              <div class="kv"><div class="k" data-i18n="school">School:</div><div class="v" id="v_school">â€”</div></div>
              <div class="kv"><div class="k" data-i18n="teacher">Homeroom / Main Teacher:</div><div class="v" id="v_teacher">â€”</div></div>
              <div class="kv"><div class="k" data-i18n="todayDate">Today's Date:</div><div class="v" id="v_todayDate">â€”</div></div>
              <div class="kv"><div class="k" data-i18n="term">Reporting Period (Term):</div><div class="v" id="v_term">â€”</div></div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">B</span> <span data-i18n="secB">ğŸ˜ŠğŸ« How School Feels Right Now</span></div>
          <div class="section-body">
            <div class="kv">
              <div class="k" data-i18n="b1">How does my child seem to feel about school overall? (check all that fit)</div>
              <div class="v" id="v_feelings">â€”</div>
            </div>
            <div style="height:10px;"></div>
            <div class="kv">
              <div class="k" data-i18n="b2">How do I feel about this school year so far?</div>
              <div class="v" id="v_yearFeel">â€”</div>
            </div>
            <div style="height:10px;"></div>
            <div class="kv">
              <div class="k" data-i18n="yearSummaryLabel">ğŸ“ In one or two sentences, describe this school year so far:</div>
              <div class="v" id="v_yearSummary">â€”</div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">C</span> <span data-i18n="secC">ğŸ“Šâœï¸ Quick Academic Snapshot</span></div>
          <div class="section-body">
            <div class="muted" data-i18n="cHint">ğŸ“Œ Use your report card, grading portal, or teacher comments to fill this in.</div>
            <div class="kv"><div class="k" data-i18n="cReading">Reading / ELA</div><div class="v" id="v_reading">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="cMath">Math</div><div class="v" id="v_math">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="cScience">Science</div><div class="v" id="v_science">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="cSocial">Social Studies</div><div class="v" id="v_social">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" id="v_other1k">Other</div><div class="v" id="v_other1">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" id="v_other2k">Other</div><div class="v" id="v_other2">â€”</div></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">D</span> <span data-i18n="secD">ğŸ¯ğŸ§  Behavior, Focus & Organization</span></div>
          <div class="section-body">
            <div class="kv"><div class="k" data-i18n="dAtSchoolTitle">ğŸ« At school</div><div class="v" id="v_schoolBeh">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="dAtHomeTitle">ğŸ  At home during homework / study time</div><div class="v" id="v_homeBeh">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="behaviorNotesLabel">ğŸ—’ï¸ Notes:</div><div class="v" id="v_behaviorNotes">â€”</div></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">E</span> <span data-i18n="secE">ğŸŒŸğŸ† Strengths & Wins</span></div>
          <div class="section-body">
            <div class="kv"><div class="k" data-i18n="strengthsAcademic">ğŸ“š Academic / learning strengths:</div><div class="v" id="v_strengthsAcademic">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="strengthsPersonal">ğŸ’› Personal strengths (character, talents, social skills):</div><div class="v" id="v_strengthsPersonal">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="wins">ğŸ† Wins from this school year (big or small):</div><div class="v" id="v_wins">â€”</div></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">F</span> <span data-i18n="secF">âš ï¸ğŸ˜£ Challenges & Worries</span></div>
          <div class="section-body">
            <div class="kv"><div class="k" data-i18n="concernsTop">âš ï¸ Top concerns (academic, emotional, or behavior):</div><div class="v" id="v_concernsTop">â€”</div></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">G</span> <span data-i18n="secG">â“ğŸ—£ï¸ Questions for the School / Teacher</span></div>
          <div class="section-body">
            <div class="kv"><div class="k">1ï¸âƒ£</div><div class="v" id="v_q1">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k">2ï¸âƒ£</div><div class="v" id="v_q2">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k">3ï¸âƒ£</div><div class="v" id="v_q3">â€”</div></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span class="badge">H</span> <span data-i18n="secH">ğŸ¯ğŸ“… Priority Focus for the Next 6â€“8 Weeks</span></div>
          <div class="section-body">
            <div class="kv"><div class="k" data-i18n="hTop">ğŸ¯ Top 1â€“3 focus areas (write here):</div><div class="v" id="v_priorityFocus">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="kv"><div class="k" data-i18n="supportNeeded">ğŸ¤ Support we need from school / D.E.Bs:</div><div class="v" id="v_supportNeeded">â€”</div></div>
            <div style="height:10px;"></div>
            <div class="row">
              <div class="kv"><div class="k" data-i18n="signature">âœğŸ½ Parent/Guardian Signature:</div><div class="v" id="v_signature">â€”</div></div>
              <div class="kv"><div class="k" data-i18n="signDate">ğŸ“… Date:</div><div class="v" id="v_signDate">â€”</div></div>
            </div>
          </div>
        </div>

        <div class="section" id="missingBox" style="display:none;">
          <div class="section-title"><span class="badge">!</span> <span data-i18n="missingTitle">âš ï¸ Nothing to display</span></div>
          <div class="section-body">
            <div class="muted" data-i18n="missingBody">Go back to the Snapshot, fill it out, and click â€œSave Student Snapshotâ€.</div>
          </div>
        </div>

      </div>

      <div class="actions">
        <button class="btn primary" id="btnPrint" type="button" data-i18n="btnPrint">ğŸ–¨ï¸ Print / Save as PDF</button>
        <button class="btn accent" id="btnDownloadHTML" type="button" data-i18n="btnHTML">â¬‡ï¸ Download Report (HTML)</button>
        <button class="btn secondary" id="btnDownloadTXT" type="button" data-i18n="btnTXT">â¬‡ï¸ Download (TXT)</button>
        <button class="btn secondary" id="btnDownloadJSON" type="button" data-i18n="btnJSON">â¬‡ï¸ Download (JSON)</button>
        <a class="link" href="index.html" data-i18n="btnBack">â† Back to Snapshot</a>
      </div>
    </div>
  </div>

  <script>
    // ================================
    // âœ… SAME KEYS AS index.html
    // ================================
    const STORAGE_SNAPSHOT_KEY = "debs_midyear_last_snapshot_v1";
    const STORAGE_DRAFT_KEY    = "debs_midyear_draft_v1";
    const STORAGE_LANG_KEY     = "debs_midyear_lang_v1";

    // ================================
    // âœ… I18N (short set â€“ same keys used in UI)
    // ================================
    const I18N = {
      en: {
        langLabel:"Language",
        confirmTitle:"âœ… Snapshot Saved",
        confirmSub:"Your answers are saved on this device. Use the buttons below to Print/Save as PDF or Download.",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ Student Information",
        secB:"ğŸ˜ŠğŸ« How School Feels Right Now",
        secC:"ğŸ“Šâœï¸ Quick Academic Snapshot",
        secD:"ğŸ¯ğŸ§  Behavior, Focus & Organization",
        secE:"ğŸŒŸğŸ† Strengths & Wins",
        secF:"âš ï¸ğŸ˜£ Challenges & Worries",
        secG:"â“ğŸ—£ï¸ Questions for the School / Teacher",
        secH:"ğŸ¯ğŸ“… Priority Focus for the Next 6â€“8 Weeks",

        studentName:"Student Name:",
        grade:"Grade:",
        school:"School:",
        teacher:"Homeroom / Main Teacher:",
        todayDate:"Today's Date:",
        term:"Reporting Period (Term):",
        b1:"How does my child seem to feel about school overall? (check all that fit)",
        b2:"How do I feel about this school year so far?",
        yearSummaryLabel:"ğŸ“ In one or two sentences, describe this school year so far:",

        cHint:"ğŸ“Œ Use your report card, grading portal, or teacher comments to fill this in.",
        cReading:"Reading / ELA",
        cMath:"Math",
        cScience:"Science",
        cSocial:"Social Studies",

        dAtSchoolTitle:"ğŸ« At school",
        dAtHomeTitle:"ğŸ  At home during homework / study time",
        behaviorNotesLabel:"ğŸ—’ï¸ Notes:",

        strengthsAcademic:"ğŸ“š Academic / learning strengths:",
        strengthsPersonal:"ğŸ’› Personal strengths (character, talents, social skills):",
        wins:"ğŸ† Wins from this school year (big or small):",
        concernsTop:"âš ï¸ Top concerns (academic, emotional, or behavior):",

        hTop:"ğŸ¯ Top 1â€“3 focus areas (write here):",
        supportNeeded:"ğŸ¤ Support we need from school / D.E.Bs:",
        signature:"âœğŸ½ Parent/Guardian Signature:",
        signDate:"ğŸ“… Date:",

        btnPrint:"ğŸ–¨ï¸ Print / Save as PDF",
        btnHTML:"â¬‡ï¸ Download Report (HTML)",
        btnTXT:"â¬‡ï¸ Download (TXT)",
        btnJSON:"â¬‡ï¸ Download (JSON)",
        btnBack:"â† Back to Snapshot",

        missingTitle:"âš ï¸ Nothing to display",
        missingBody:"Go back to the Snapshot, fill it out, and click â€œSave Student Snapshotâ€.",

        // value labels
        map: {
          feelings:{
            excited:"ğŸ˜ Excited most days",
            fine:"ğŸ˜ Fine / itâ€™s just school",
            anxious:"ğŸ˜Ÿ Anxious / nervous",
            bored:"ğŸ˜´ Bored / unmotivated",
            overwhelmed:"ğŸ˜£ Overwhelmed / frustrated",
            not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ Not sure / mixed signals"
          },
          yearFeel:{
            calm:"ğŸ˜Œ Mostly calm and confident",
            worried:"ğŸ˜¬ Quietly worried",
            stressed:"ğŸ˜° Very stressed and unsure what to do",
            mixed:"ğŸ­ Mixedâ€”some things are going great, others not at all"
          },
          howFeel:{
            confident:"Confident âœ…",
            okay:"Okay ğŸ™‚",
            concerned:"Concerned ğŸ˜•",
            not_sure:"Not sure ğŸ¤·ğŸ½â€â™€ï¸"
          },
          schoolBeh:{
            focused:"âœ… Usually focused and on-task",
            needs_reminders:"ğŸ” Needs reminders / redirection",
            rushes:"â© Rushes through work",
            not_finish:"ğŸ§© Often doesnâ€™t finish work",
            calls_home:"ğŸ“ Behavior notes / calls home",
            no_concerns:"ğŸ‘ No major concerns reported"
          },
          homeBeh:{
            starts_alone:"ğŸš€ Starts on their own",
            needs_reminders:"â° Needs reminders but will do it",
            tears:"ğŸ˜­ Fights / tears are common",
            negative_self_talk:"ğŸ’” Says â€œIâ€™m dumbâ€ or â€œI canâ€™t do thisâ€",
            avoids:"ğŸ™ˆ Avoids homework or hides assignments"
          }
        }
      },

      es: {
        langLabel:"Idioma",
        confirmTitle:"âœ… Resumen Guardado",
        confirmSub:"Tus respuestas estÃ¡n guardadas en este dispositivo. Usa los botones para Imprimir/Guardar como PDF o Descargar.",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ InformaciÃ³n del Estudiante",
        secB:"ğŸ˜ŠğŸ« CÃ³mo se Siente la Escuela Ahora",
        secC:"ğŸ“Šâœï¸ Resumen AcadÃ©mico RÃ¡pido",
        secD:"ğŸ¯ğŸ§  Conducta, Enfoque y OrganizaciÃ³n",
        secE:"ğŸŒŸğŸ† Fortalezas y Logros",
        secF:"âš ï¸ğŸ˜£ DesafÃ­os y Preocupaciones",
        secG:"â“ğŸ—£ï¸ Preguntas para la Escuela / Maestra(o)",
        secH:"ğŸ¯ğŸ“… Prioridades para las PrÃ³ximas 6â€“8 Semanas",

        studentName:"Nombre del estudiante:",
        grade:"Grado:",
        school:"Escuela:",
        teacher:"Maestro(a) principal:",
        todayDate:"Fecha de hoy:",
        term:"PerÃ­odo (trimestre):",
        b1:"Â¿CÃ³mo parece sentirse mi hijo/a sobre la escuela en general? (marca todas las que correspondan)",
        b2:"Â¿CÃ³mo me siento yo con este aÃ±o escolar hasta ahora?",
        yearSummaryLabel:"ğŸ“ En una o dos oraciones, describe este aÃ±o escolar hasta ahora:",

        cHint:"ğŸ“Œ Usa la boleta, el portal o comentarios del maestro.",
        cReading:"Lectura / ELA",
        cMath:"MatemÃ¡ticas",
        cScience:"Ciencias",
        cSocial:"Estudios sociales",

        dAtSchoolTitle:"ğŸ« En la escuela",
        dAtHomeTitle:"ğŸ  En casa durante la tarea / estudio",
        behaviorNotesLabel:"ğŸ—’ï¸ Notas:",

        strengthsAcademic:"ğŸ“š Fortalezas acadÃ©micas / aprendizaje:",
        strengthsPersonal:"ğŸ’› Fortalezas personales:",
        wins:"ğŸ† Logros de este aÃ±o:",
        concernsTop:"âš ï¸ Principales preocupaciones:",

        hTop:"ğŸ¯ 1â€“3 prioridades:",
        supportNeeded:"ğŸ¤ Apoyo que necesitamos:",
        signature:"âœğŸ½ Firma del padre/madre/tutor:",
        signDate:"ğŸ“… Fecha:",

        btnPrint:"ğŸ–¨ï¸ Imprimir / Guardar como PDF",
        btnHTML:"â¬‡ï¸ Descargar informe (HTML)",
        btnTXT:"â¬‡ï¸ Descargar (TXT)",
        btnJSON:"â¬‡ï¸ Descargar (JSON)",
        btnBack:"â† Volver al formulario",

        missingTitle:"âš ï¸ Nada que mostrar",
        missingBody:"Vuelve al formulario, complÃ©talo y haz clic en â€œGuardarâ€.",

        map:{
          feelings:{
            excited:"ğŸ˜ Emocionado/a la mayorÃ­a de los dÃ­as",
            fine:"ğŸ˜ Bien / es solo la escuela",
            anxious:"ğŸ˜Ÿ Ansioso/a / nervioso/a",
            bored:"ğŸ˜´ Aburrido/a / sin motivaciÃ³n",
            overwhelmed:"ğŸ˜£ Abrumado/a / frustrado/a",
            not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ No estoy seguro/a / seÃ±ales mixtas"
          },
          yearFeel:{
            calm:"ğŸ˜Œ Mayormente tranquilo/a y con confianza",
            worried:"ğŸ˜¬ PreocupaciÃ³n silenciosa",
            stressed:"ğŸ˜° Muy estresado/a y sin saber quÃ© hacer",
            mixed:"ğŸ­ Mixtoâ€”algunas cosas van muy bien, otras no"
          },
          howFeel:{
            confident:"Con confianza âœ…",
            okay:"Bien ğŸ™‚",
            concerned:"Preocupado/a ğŸ˜•",
            not_sure:"No estoy seguro/a ğŸ¤·ğŸ½â€â™€ï¸"
          },
          schoolBeh:{
            focused:"âœ… Usualmente enfocado/a",
            needs_reminders:"ğŸ” Necesita recordatorios / redirecciÃ³n",
            rushes:"â© Se apresura",
            not_finish:"ğŸ§© A menudo no termina",
            calls_home:"ğŸ“ Notas de conducta / llamadas a casa",
            no_concerns:"ğŸ‘ Sin preocupaciones mayores"
          },
          homeBeh:{
            starts_alone:"ğŸš€ Empieza por su cuenta",
            needs_reminders:"â° Necesita recordatorios pero lo hace",
            tears:"ğŸ˜­ Peleas / lÃ¡grimas son comunes",
            negative_self_talk:"ğŸ’” Dice â€œsoy tonto/aâ€ o â€œno puedoâ€",
            avoids:"ğŸ™ˆ Evita la tarea u oculta tareas"
          }
        }
      },

      fr: {
        langLabel:"Langue",
        confirmTitle:"âœ… AperÃ§u enregistrÃ©",
        confirmSub:"Vos rÃ©ponses sont enregistrÃ©es sur cet appareil. Utilisez les boutons pour Imprimer/Enregistrer en PDF ou TÃ©lÃ©charger.",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ Infos Ã‰lÃ¨ve",
        secB:"ğŸ˜ŠğŸ« Ressenti de lâ€™Ã‰cole (Maintenant)",
        secC:"ğŸ“Šâœï¸ AperÃ§u AcadÃ©mique Rapide",
        secD:"ğŸ¯ğŸ§  Comportement, Concentration & Organisation",
        secE:"ğŸŒŸğŸ† Forces & RÃ©ussites",
        secF:"âš ï¸ğŸ˜£ DÃ©fis & InquiÃ©tudes",
        secG:"â“ğŸ—£ï¸ Questions pour lâ€™Ã‰cole / lâ€™Enseignant",
        secH:"ğŸ¯ğŸ“… PrioritÃ©s pour les 6â€“8 Prochaines Semaines",

        studentName:"Nom de lâ€™Ã©lÃ¨ve :",
        grade:"Classe / Niveau :",
        school:"Ã‰cole :",
        teacher:"Enseignant principal :",
        todayDate:"Date du jour :",
        term:"PÃ©riode (trimestre) :",
        b1:"Comment mon enfant semble-t-il/elle se sentir par rapport Ã  lâ€™Ã©cole ? (cochez tout ce qui sâ€™applique)",
        b2:"Comment est-ce que je me sens par rapport Ã  cette annÃ©e scolaire ?",
        yearSummaryLabel:"ğŸ“ En une ou deux phrases, dÃ©crivez cette annÃ©e scolaire jusquâ€™ici :",

        cHint:"ğŸ“Œ Utilisez le bulletin, le portail, ou les commentaires.",
        cReading:"Lecture / ELA",
        cMath:"Maths",
        cScience:"Sciences",
        cSocial:"Sciences sociales",

        dAtSchoolTitle:"ğŸ« Ã€ lâ€™Ã©cole",
        dAtHomeTitle:"ğŸ  Ã€ la maison (devoirs / Ã©tude)",
        behaviorNotesLabel:"ğŸ—’ï¸ Notes :",

        strengthsAcademic:"ğŸ“š Forces acadÃ©miques :",
        strengthsPersonal:"ğŸ’› Forces personnelles :",
        wins:"ğŸ† RÃ©ussites :",
        concernsTop:"âš ï¸ Principales inquiÃ©tudes :",

        hTop:"ğŸ¯ 1â€“3 prioritÃ©s :",
        supportNeeded:"ğŸ¤ Soutien nÃ©cessaire :",
        signature:"âœğŸ½ Signature parent/tuteur :",
        signDate:"ğŸ“… Date :",

        btnPrint:"ğŸ–¨ï¸ Imprimer / Enregistrer en PDF",
        btnHTML:"â¬‡ï¸ TÃ©lÃ©charger le rapport (HTML)",
        btnTXT:"â¬‡ï¸ TÃ©lÃ©charger (TXT)",
        btnJSON:"â¬‡ï¸ TÃ©lÃ©charger (JSON)",
        btnBack:"â† Retour au formulaire",

        missingTitle:"âš ï¸ Rien Ã  afficher",
        missingBody:"Retournez au formulaire, remplissez-le et cliquez sur Â« Enregistrer Â». ",

        map:{
          feelings:{
            excited:"ğŸ˜ Enthousiaste la plupart des jours",
            fine:"ğŸ˜ Ã‡a va / Â« câ€™est lâ€™Ã©cole Â»",
            anxious:"ğŸ˜Ÿ Anxieux(se) / nerveux(se)",
            bored:"ğŸ˜´ EnnuyÃ©(e) / dÃ©motivÃ©(e)",
            overwhelmed:"ğŸ˜£ DÃ©bordÃ©(e) / frustrÃ©(e)",
            not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ Pas sÃ»r(e) / signaux mixtes"
          },
          yearFeel:{
            calm:"ğŸ˜Œ PlutÃ´t calme et confiant(e)",
            worried:"ğŸ˜¬ Inquiet(Ã¨te) en silence",
            stressed:"ğŸ˜° TrÃ¨s stressÃ©(e) et perdu(e)",
            mixed:"ğŸ­ MitigÃ©â€”certaines choses vont bien, dâ€™autres non"
          },
          howFeel:{
            confident:"Confiant(e) âœ…",
            okay:"Ã‡a va ğŸ™‚",
            concerned:"Inquiet(Ã¨te) ğŸ˜•",
            not_sure:"Pas sÃ»r(e) ğŸ¤·ğŸ½â€â™€ï¸"
          },
          schoolBeh:{
            focused:"âœ… Souvent concentrÃ©(e)",
            needs_reminders:"ğŸ” Besoin de rappels / recadrage",
            rushes:"â© Va trop vite",
            not_finish:"ğŸ§© Ne finit pas souvent",
            calls_home:"ğŸ“ Notes / appels Ã  la maison",
            no_concerns:"ğŸ‘ Aucune inquiÃ©tude majeure"
          },
          homeBeh:{
            starts_alone:"ğŸš€ Commence seul(e)",
            needs_reminders:"â° Besoin de rappels mais le fait",
            tears:"ğŸ˜­ Conflits / larmes frÃ©quents",
            negative_self_talk:"ğŸ’” Dit Â« je suis nul(le) Â» / Â« je nâ€™y arrive pas Â»",
            avoids:"ğŸ™ˆ Ã‰vite / cache des devoirs"
          }
        }
      },

      zh: {
        langLabel:"è¯­è¨€",
        confirmTitle:"âœ… å·²ä¿å­˜å¿«ç…§",
        confirmSub:"ä½ çš„å›ç­”å·²ä¿å­˜åœ¨æ­¤è®¾å¤‡ä¸Šã€‚å¯æ‰“å°/å¦å­˜ä¸ºPDFæˆ–ä¸‹è½½ã€‚",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ å­¦ç”Ÿä¿¡æ¯",
        secB:"ğŸ˜ŠğŸ« ç›®å‰çš„ä¸Šå­¦æ„Ÿå—",
        secC:"ğŸ“Šâœï¸ å­¦ä¸šå¿«é€Ÿæ¦‚è§ˆ",
        secD:"ğŸ¯ğŸ§  è¡Œä¸ºã€ä¸“æ³¨ä¸ç»„ç»‡",
        secE:"ğŸŒŸğŸ† ä¼˜åŠ¿ä¸æˆæœ",
        secF:"âš ï¸ğŸ˜£ æŒ‘æˆ˜ä¸æ‹…å¿§",
        secG:"â“ğŸ—£ï¸ ç»™å­¦æ ¡/è€å¸ˆçš„é—®é¢˜",
        secH:"ğŸ¯ğŸ“… æœªæ¥6â€“8å‘¨çš„ä¼˜å…ˆé‡ç‚¹",

        studentName:"å­¦ç”Ÿå§“åï¼š",
        grade:"å¹´çº§ï¼š",
        school:"å­¦æ ¡ï¼š",
        teacher:"ç­ä¸»ä»»/ä¸»è¦è€å¸ˆï¼š",
        todayDate:"ä»Šå¤©æ—¥æœŸï¼š",
        term:"å­¦æœŸ/é˜¶æ®µï¼š",
        b1:"å­©å­æ€»ä½“å¯¹å­¦æ ¡çš„æ„Ÿè§‰å¦‚ä½•ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰",
        b2:"æˆ‘å¯¹ç›®å‰è¿™ä¸ªå­¦å¹´çš„æ„Ÿè§‰æ˜¯ï¼Ÿ",
        yearSummaryLabel:"ğŸ“ ç”¨ä¸€ä¸¤å¥è¯æè¿°ç›®å‰è¿™ä¸ªå­¦å¹´ï¼š",

        cHint:"ğŸ“Œ è¯·å‚è€ƒæˆç»©å•ã€å®¶é•¿å¹³å°æˆ–è€å¸ˆåé¦ˆã€‚",
        cReading:"é˜…è¯»/è‹±è¯­(ELA)",
        cMath:"æ•°å­¦",
        cScience:"ç§‘å­¦",
        cSocial:"ç¤¾ä¼šå­¦ç§‘",

        dAtSchoolTitle:"ğŸ« åœ¨å­¦æ ¡",
        dAtHomeTitle:"ğŸ  åœ¨å®¶å†™ä½œä¸š/å­¦ä¹ æ—¶",
        behaviorNotesLabel:"ğŸ—’ï¸ å¤‡æ³¨ï¼š",

        strengthsAcademic:"ğŸ“š å­¦ä¸š/å­¦ä¹ ä¼˜åŠ¿ï¼š",
        strengthsPersonal:"ğŸ’› ä¸ªäººä¼˜åŠ¿ï¼š",
        wins:"ğŸ† æˆå°±ï¼š",
        concernsTop:"âš ï¸ ä¸»è¦æ‹…å¿§ï¼š",

        hTop:"ğŸ¯ 1â€“3 ä¸ªé‡ç‚¹ï¼š",
        supportNeeded:"ğŸ¤ éœ€è¦çš„æ”¯æŒï¼š",
        signature:"âœğŸ½ å®¶é•¿/ç›‘æŠ¤äººç­¾åï¼š",
        signDate:"ğŸ“… æ—¥æœŸï¼š",

        btnPrint:"ğŸ–¨ï¸ æ‰“å°/å¦å­˜ä¸ºPDF",
        btnHTML:"â¬‡ï¸ ä¸‹è½½æŠ¥å‘Š (HTML)",
        btnTXT:"â¬‡ï¸ ä¸‹è½½ (TXT)",
        btnJSON:"â¬‡ï¸ ä¸‹è½½ (JSON)",
        btnBack:"â† è¿”å›è¡¨å•",

        missingTitle:"âš ï¸ æ²¡æœ‰å¯æ˜¾ç¤ºå†…å®¹",
        missingBody:"è¿”å›è¡¨å•å¡«å†™å¹¶ç‚¹å‡»â€œä¿å­˜â€ã€‚",

        map:{
          feelings:{
            excited:"ğŸ˜ å¤§å¤šæ•°æ—¶å€™å¾ˆæœŸå¾…",
            fine:"ğŸ˜ è¿˜å¥½/å°±æ˜¯ä¸Šå­¦",
            anxious:"ğŸ˜Ÿ ç„¦è™‘/ç´§å¼ ",
            bored:"ğŸ˜´ æ— èŠ/ç¼ºä¹åŠ¨åŠ›",
            overwhelmed:"ğŸ˜£ å‹åŠ›å¤§/æ²®ä¸§",
            not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ ä¸ç¡®å®š/ä¿¡å·æ··æ‚"
          },
          yearFeel:{
            calm:"ğŸ˜Œ åŸºæœ¬å†·é™ä¸”æœ‰ä¿¡å¿ƒ",
            worried:"ğŸ˜¬ æš—è‡ªæ‹…å¿ƒ",
            stressed:"ğŸ˜° å¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠ",
            mixed:"ğŸ­ å¤æ‚â€”æœ‰äº›å¾ˆå¥½ï¼Œæœ‰äº›ä¸å¤ªè¡Œ"
          },
          howFeel:{
            confident:"æœ‰ä¿¡å¿ƒ âœ…",
            okay:"è¿˜å¯ä»¥ ğŸ™‚",
            concerned:"æ‹…å¿ƒ ğŸ˜•",
            not_sure:"ä¸ç¡®å®š ğŸ¤·ğŸ½â€â™€ï¸"
          },
          schoolBeh:{
            focused:"âœ… é€šå¸¸ä¸“æ³¨",
            needs_reminders:"ğŸ” éœ€è¦æé†’/çº æ­£",
            rushes:"â© åšé¢˜å¤ªå¿«",
            not_finish:"ğŸ§© ç»å¸¸åšä¸å®Œ",
            calls_home:"ğŸ“ è¡Œä¸ºè®°å½•/æ‰“ç”µè¯å›å®¶",
            no_concerns:"ğŸ‘ æ²¡æœ‰é‡å¤§é—®é¢˜"
          },
          homeBeh:{
            starts_alone:"ğŸš€ èƒ½è‡ªå·±å¼€å§‹",
            needs_reminders:"â° éœ€è¦æé†’ä½†èƒ½åš",
            tears:"ğŸ˜­ äº‰æ‰§/å“­é—¹å¸¸è§",
            negative_self_talk:"ğŸ’” è¯´â€œæˆ‘å¾ˆç¬¨/æˆ‘ä¸è¡Œâ€",
            avoids:"ğŸ™ˆ é€ƒé¿ä½œä¸š/è—ä½œä¸š"
          }
        }
      }
    };

    let currentLang = "en";
    function t(key){
      return (I18N[currentLang] && I18N[currentLang][key]) || (I18N.en[key]) || key;
    }
    function label(group, code){
      const m = (I18N[currentLang] && I18N[currentLang].map && I18N[currentLang].map[group]) || (I18N.en.map[group]) || {};
      return m[code] || code || "â€”";
    }
    function applyI18n(){
      document.documentElement.lang = currentLang;
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        el.innerHTML = t(el.dataset.i18n);
      });
      const langSel = document.getElementById("langSelect");
      if(langSel) langSel.value = currentLang;
    }

    // ================================
    // âœ… DATA LOADING
    // ================================
    function safeParse(raw){
      try { return JSON.parse(raw); } catch { return null; }
    }

    function readFromLocalStorage(){
      const raw = localStorage.getItem(STORAGE_SNAPSHOT_KEY) || localStorage.getItem(STORAGE_DRAFT_KEY);
      return raw ? safeParse(raw) : null;
    }

    function readFromQuery(){
      const q = Object.fromEntries(new URLSearchParams(window.location.search));
      // If query only contains lang, treat it as "no data"
      const hasRealData = ["studentName","grade","payload"].some(k => (q[k] && String(q[k]).trim().length));
      if(!hasRealData) return null;

      if(q.payload){
        const parsed = safeParse(q.payload);
        if(parsed) return parsed;
      }
      return q;
    }

    function getData(){
      // Priority: localStorage (because index saves there), then query (if payload provided)
      const fromLS = readFromLocalStorage();
      if(fromLS) return fromLS;
      const fromQ = readFromQuery();
      if(fromQ) return fromQ;
      return null;
    }

    // ================================
    // âœ… RENDER
    // ================================
    function setText(id, val){
      const el = document.getElementById(id);
      if(!el) return;
      el.textContent = (val && String(val).trim().length) ? String(val) : "â€”";
    }

    function renderAcademic(a){
      if(!a) return { grade:"", feel:"", notes:"" };
      const grade = a.grade || "";
      const feel = a.feel ? label("howFeel", a.feel) : "";
      const notes = a.notes || "";
      return [grade && ("Grade/Level: " + grade), feel && ("How I Feel: " + feel), notes && ("Notes: " + notes)].filter(Boolean).join("\n");
    }

    function render(){
      const data = getData();
      if(!data){
        document.getElementById("missingBox").style.display = "block";
        return;
      }

      // Update language if saved
      currentLang = new URLSearchParams(window.location.search).get("lang") || data._lang || localStorage.getItem(STORAGE_LANG_KEY) || "en";
      if(!I18N[currentLang]) currentLang = "en";
      applyI18n();

      setText("v_studentName", data.studentName);
      setText("v_grade", data.grade);
      setText("v_school", data.school);
      setText("v_teacher", data.teacher);
      setText("v_todayDate", data.todayDate);
      setText("v_term", data.term);

      // Feelings
      const feelingsArr = Array.isArray(data.feelings) ? data.feelings : [];
      const feelText = feelingsArr.length ? feelingsArr.map(c=> "â€¢ " + label("feelings", c)).join("\n") : "â€”";
      setText("v_feelings", feelText);

      setText("v_yearFeel", data.yearFeel ? label("yearFeel", data.yearFeel) : "");
      setText("v_yearSummary", data.yearSummary);

      // Academic
      const ac = data.academic || {};
      setText("v_reading", renderAcademic(ac.reading));
      setText("v_math", renderAcademic(ac.math));
      setText("v_science", renderAcademic(ac.science));
      setText("v_social", renderAcademic(ac.social));

      const other1Name = (ac.other1 && ac.other1.name) ? ac.other1.name : "";
      document.getElementById("v_other1k").textContent = other1Name ? other1Name : "Other";
      setText("v_other1", renderAcademic(ac.other1));

      const other2Name = (ac.other2 && ac.other2.name) ? ac.other2.name : "";
      document.getElementById("v_other2k").textContent = other2Name ? other2Name : "Other";
      setText("v_other2", renderAcademic(ac.other2));

      // Behavior
      const sb = Array.isArray(data.schoolBeh) ? data.schoolBeh : [];
      const hb = Array.isArray(data.homeBeh) ? data.homeBeh : [];

      setText("v_schoolBeh", sb.length ? sb.map(c=>"â€¢ "+label("schoolBeh", c)).join("\n") : "â€”");
      setText("v_homeBeh", hb.length ? hb.map(c=>"â€¢ "+label("homeBeh", c)).join("\n") : "â€”");
      setText("v_behaviorNotes", data.behaviorNotes);

      // Strengths, concerns
      setText("v_strengthsAcademic", data.strengthsAcademic);
      setText("v_strengthsPersonal", data.strengthsPersonal);
      setText("v_wins", data.wins);
      setText("v_concernsTop", data.concernsTop);

      // Questions
      setText("v_q1", data.questions && data.questions.q1);
      setText("v_q2", data.questions && data.questions.q2);
      setText("v_q3", data.questions && data.questions.q3);

      // Priority + signature
      setText("v_priorityFocus", data.priorityFocus);
      setText("v_supportNeeded", data.supportNeeded);
      setText("v_signature", data.signature);
      setText("v_signDate", data.signDate);
    }

    // ================================
    // âœ… DOWNLOADS
    // ================================
    function fileSafeName(s){
      return (s || "snapshot").toString().trim().replace(/[^\w\-]+/g,"_").slice(0,60) || "snapshot";
    }
    function downloadBlob(filename, mime, content){
      const blob = new Blob([content], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 800);
    }

    function getCurrentData(){
      return getData() || {};
    }

    function buildTxtReport(d){
      const lines = [];
      lines.push("MID-YEAR STUDENT SNAPSHOT");
      lines.push("D.E.Bs Learning Academy");
      lines.push("----------------------------------------");
      lines.push(`Student: ${d.studentName||""}`);
      lines.push(`Grade: ${d.grade||""}`);
      lines.push(`School: ${d.school||""}`);
      lines.push(`Teacher: ${d.teacher||""}`);
      lines.push(`Date: ${d.todayDate||""}`);
      lines.push(`Term: ${d.term||""}`);
      lines.push("");
      lines.push("B) HOW SCHOOL FEELS");
      const feelings = (d.feelings||[]).map(c=>"- "+label("feelings", c)).join("\n");
      lines.push("Child feelings:\n"+(feelings||""));
      lines.push("Parent year feel: "+(d.yearFeel?label("yearFeel", d.yearFeel):""));
      lines.push("Summary:\n"+(d.yearSummary||""));
      lines.push("");
      lines.push("C) ACADEMICS");
      function acLine(name, obj){
        if(!obj) return;
        const parts = [];
        if(obj.grade) parts.push("grade/level: "+obj.grade);
        if(obj.feel) parts.push("feel: "+label("howFeel", obj.feel));
        if(obj.notes) parts.push("notes: "+obj.notes);
        lines.push(name+": "+parts.join(" | "));
      }
      const a = d.academic||{};
      acLine("Reading/ELA", a.reading);
      acLine("Math", a.math);
      acLine("Science", a.science);
      acLine("Social Studies", a.social);
      if(a.other1 && (a.other1.name||a.other1.grade||a.other1.feel||a.other1.notes)) acLine(a.other1.name||"Other 1", a.other1);
      if(a.other2 && (a.other2.name||a.other2.grade||a.other2.feel||a.other2.notes)) acLine(a.other2.name||"Other 2", a.other2);

      lines.push("");
      lines.push("D) BEHAVIOR");
      const sb = (d.schoolBeh||[]).map(c=>"- "+label("schoolBeh", c)).join("\n");
      const hb = (d.homeBeh||[]).map(c=>"- "+label("homeBeh", c)).join("\n");
      lines.push("At school:\n"+sb);
      lines.push("At home:\n"+hb);
      lines.push("Notes:\n"+(d.behaviorNotes||""));

      lines.push("");
      lines.push("E) STRENGTHS & WINS");
      lines.push("Academic strengths:\n"+(d.strengthsAcademic||""));
      lines.push("Personal strengths:\n"+(d.strengthsPersonal||""));
      lines.push("Wins:\n"+(d.wins||""));

      lines.push("");
      lines.push("F) CHALLENGES");
      lines.push(d.concernsTop||"");

      lines.push("");
      lines.push("G) QUESTIONS");
      lines.push("1) "+((d.questions&&d.questions.q1)||""));
      lines.push("2) "+((d.questions&&d.questions.q2)||""));
      lines.push("3) "+((d.questions&&d.questions.q3)||""));

      lines.push("");
      lines.push("H) PRIORITY FOCUS");
      lines.push("Focus:\n"+(d.priorityFocus||""));
      lines.push("Support needed:\n"+(d.supportNeeded||""));
      lines.push("Signature: "+(d.signature||""));
      lines.push("Sign date: "+(d.signDate||""));

      return lines.join("\n");
    }

    function buildHtmlReport(d){
      const esc = (s)=>String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
      const list = (arr, grp)=> (arr && arr.length) ? ("<ul>"+arr.map(c=>"<li>"+esc(label(grp,c))+"</li>").join("")+"</ul>") : "<p>â€”</p>";
      const ac = d.academic||{};
      const acRow = (title, obj)=> {
        if(!obj) obj = {};
        const feel = obj.feel ? label("howFeel", obj.feel) : "";
        return `<tr><td>${esc(title)}</td><td>${esc(obj.grade||"")}</td><td>${esc(feel)}</td><td>${esc(obj.notes||"")}</td></tr>`;
      };
      const other1Title = (ac.other1 && ac.other1.name) ? ac.other1.name : "Other";
      const other2Title = (ac.other2 && ac.other2.name) ? ac.other2.name : "Other";

      return `<!doctype html>
<html lang="${esc(d._lang||"en")}"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mid-Year Student Snapshot Report</title>
<style>
  body{font-family:Arial,system-ui,sans-serif;margin:0;padding:24px;background:#f3f4ff;color:#111827;}
  .card{max-width:820px;margin:0 auto;background:#fff;border:1px solid #e5e7ff;border-radius:12px;overflow:hidden;}
  .head{padding:18px 18px 10px;text-align:center;border-bottom:3px solid #6b63c6;}
  .head h1{margin:0;font-size:20px;}
  .sub{color:#475569;font-size:12px;margin-top:6px;}
  .sec{padding:14px 16px;border-top:1px solid #e5e7ff;}
  .sec h2{margin:0 0 10px;font-size:14px;background:#6b63c6;color:#fff;padding:8px 10px;border-radius:8px;}
  .kv{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .box{border:1px solid #dbe4f2;border-radius:10px;background:#fbfcff;padding:10px;}
  .k{font-weight:800;font-size:11px;color:#334155;margin-bottom:4px;}
  .v{white-space:pre-wrap;font-size:12px;}
  table{width:100%;border-collapse:collapse;font-size:12px;}
  th,td{border:1px solid #dbe4f2;padding:8px;vertical-align:top;}
  th{background:#f6f8ff;text-align:left;}
  ul{margin:6px 0 0 18px;}
</style></head>
<body>
  <div class="card">
    <div class="head">
      <h1>Mid-Year Student Snapshot</h1>
      <div class="sub">D.E.Bs Learning Academy</div>
    </div>

    <div class="sec">
      <h2>A) Student Information</h2>
      <div class="kv">
        <div class="box"><div class="k">Student</div><div class="v">${esc(d.studentName||"")}</div></div>
        <div class="box"><div class="k">Grade</div><div class="v">${esc(d.grade||"")}</div></div>
        <div class="box"><div class="k">School</div><div class="v">${esc(d.school||"")}</div></div>
        <div class="box"><div class="k">Teacher</div><div class="v">${esc(d.teacher||"")}</div></div>
        <div class="box"><div class="k">Date</div><div class="v">${esc(d.todayDate||"")}</div></div>
        <div class="box"><div class="k">Term</div><div class="v">${esc(d.term||"")}</div></div>
      </div>
    </div>

    <div class="sec">
      <h2>B) How School Feels</h2>
      <div class="box"><div class="k">Child feelings</div>${list(d.feelings||[],"feelings")}</div><br/>
      <div class="box"><div class="k">Parent feel</div><div class="v">${esc(d.yearFeel?label("yearFeel",d.yearFeel):"")}</div></div><br/>
      <div class="box"><div class="k">Summary</div><div class="v">${esc(d.yearSummary||"")}</div></div>
    </div>

    <div class="sec">
      <h2>C) Academics</h2>
      <table>
        <thead><tr><th>Subject</th><th>Grade/Level</th><th>How I Feel</th><th>Notes</th></tr></thead>
        <tbody>
          ${acRow("Reading/ELA", ac.reading)}
          ${acRow("Math", ac.math)}
          ${acRow("Science", ac.science)}
          ${acRow("Social Studies", ac.social)}
          ${acRow(other1Title, ac.other1)}
          ${acRow(other2Title, ac.other2)}
        </tbody>
      </table>
    </div>

    <div class="sec">
      <h2>D) Behavior</h2>
      <div class="box"><div class="k">At school</div>${list(d.schoolBeh||[],"schoolBeh")}</div><br/>
      <div class="box"><div class="k">At home</div>${list(d.homeBeh||[],"homeBeh")}</div><br/>
      <div class="box"><div class="k">Notes</div><div class="v">${esc(d.behaviorNotes||"")}</div></div>
    </div>

    <div class="sec">
      <h2>E) Strengths & Wins</h2>
      <div class="box"><div class="k">Academic strengths</div><div class="v">${esc(d.strengthsAcademic||"")}</div></div><br/>
      <div class="box"><div class="k">Personal strengths</div><div class="v">${esc(d.strengthsPersonal||"")}</div></div><br/>
      <div class="box"><div class="k">Wins</div><div class="v">${esc(d.wins||"")}</div></div>
    </div>

    <div class="sec">
      <h2>F) Challenges</h2>
      <div class="box"><div class="v">${esc(d.concernsTop||"")}</div></div>
    </div>

    <div class="sec">
      <h2>G) Questions</h2>
      <div class="box"><div class="v">1) ${esc((d.questions&&d.questions.q1)||"")}\n2) ${esc((d.questions&&d.questions.q2)||"")}\n3) ${esc((d.questions&&d.questions.q3)||"")}</div></div>
    </div>

    <div class="sec">
      <h2>H) Priority Focus</h2>
      <div class="box"><div class="k">Focus</div><div class="v">${esc(d.priorityFocus||"")}</div></div><br/>
      <div class="box"><div class="k">Support needed</div><div class="v">${esc(d.supportNeeded||"")}</div></div><br/>
      <div class="kv">
        <div class="box"><div class="k">Signature</div><div class="v">${esc(d.signature||"")}</div></div>
        <div class="box"><div class="k">Date</div><div class="v">${esc(d.signDate||"")}</div></div>
      </div>
    </div>

  </div>
</body></html>`;
    }

    // ================================
    // âœ… ACTIONS
    // ================================
    function init(){
      // Language init
      const urlLang = new URLSearchParams(window.location.search).get("lang");
      const stored = localStorage.getItem(STORAGE_LANG_KEY);
      currentLang = urlLang || stored || "en";
      if(!I18N[currentLang]) currentLang = "en";
      applyI18n();

      // Render
      render();

      // Language switcher
      const langSel = document.getElementById("langSelect");
      if(langSel){
        langSel.addEventListener("change", ()=>{
          currentLang = langSel.value;
          localStorage.setItem(STORAGE_LANG_KEY, currentLang);
          applyI18n();
          render(); // re-render value labels
        });
      }

      document.getElementById("btnPrint").addEventListener("click", ()=> window.print());

      document.getElementById("btnDownloadJSON").addEventListener("click", ()=>{
        const d = getCurrentData();
        const name = fileSafeName(d.studentName || "student");
        downloadBlob(`snapshot_${name}.json`, "application/json", JSON.stringify(d, null, 2));
      });

      document.getElementById("btnDownloadTXT").addEventListener("click", ()=>{
        const d = getCurrentData();
        const name = fileSafeName(d.studentName || "student");
        downloadBlob(`snapshot_${name}.txt`, "text/plain", buildTxtReport(d));
      });

      document.getElementById("btnDownloadHTML").addEventListener("click", ()=>{
        const d = getCurrentData();
        const name = fileSafeName(d.studentName || "student");
        downloadBlob(`snapshot_${name}.html`, "text/html", buildHtmlReport(d));
      });
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>