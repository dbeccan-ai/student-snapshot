<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mid-Year Student Snapshot | D.E.Bs Learning Academy</title>

  <style>
    :root{
      /* DEBs-ish palette */
      --bg:#0b5cff;          /* electric blue */
      --bg-dark:#083fb2;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --line:#dbe4f2;
      --bar:#1239ff;         /* section bar */
      --bar-dark:#0b2bd6;
      --accent:#ffde59;      /* DEBs yellow */
      --radius:12px;
      --radius2:10px;
      --shadow:0 18px 45px rgba(0,0,0,.22);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--font);
      background: linear-gradient(180deg, var(--bg) 0%, var(--bg-dark) 100%);
      color:var(--ink);
      min-height:100vh;
      padding: 22px 12px 60px;
    }

    .container{
      max-width: 820px;
      margin: 0 auto;
    }

    /* Top mini header (NOT the old toolbar) */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
      color:#fff;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .brand-badge{
      width:34px;height:34px;
      border-radius:10px;
      background: var(--accent);
      color:#111827;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
    }
    .topbar small{
      opacity:.9;
      font-weight:700;
    }

    .langwrap{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .langlabel{
      font-weight:900;
      font-size:12px;
      opacity:.95;
    }
    #langSelect{
      background: rgba(255,255,255,.14);
      color:#fff;
      border: 1px solid rgba(255,255,255,.25);
      padding: 10px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      outline:none;
    }
    #langSelect option{ color:#111; }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.05);
    }

    .head{
      padding: 18px 18px 12px;
      text-align:center;
      border-bottom: 1px solid rgba(2,6,23,.06);
      position: relative;
    }
    .head h1{
      margin:0;
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: .2px;
    }
    .head .sub{
      margin: 6px 0 0;
      font-size: 12px;
      color: var(--muted);
      font-style: italic;
      font-weight: 700;
    }

    .content{
      padding: 12px 14px 16px;
    }

    .section{
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      margin-bottom: 12px;
      overflow:hidden;
      background:#fff;
    }
    .section-title{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--bar) 0%, var(--bar-dark) 100%);
      color:#fff;
      font-weight: 1000;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .badge{
      width:20px;height:20px;
      border-radius:6px;
      background: rgba(255,255,255,.18);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size: 12px;
      font-weight: 1000;
    }
    .section-body{
      padding: 12px;
    }

    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 720px){
      .grid-2{ grid-template-columns: 1fr; }
      .topbar{ justify-content:center; }
      .langwrap{ justify-content:center; width:100%; }
    }

    label{
      display:block;
      font-size: 11px;
      font-weight: 1000;
      color: #1f2937;
      margin: 0 0 6px;
    }

    input[type="text"],
    input[type="date"],
    textarea,
    select{
      width:100%;
      padding: 10px 10px;
      border: 1.5px solid var(--line);
      border-radius: 8px;
      font-size: 12px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
      background:#fff;
    }
    input:focus, textarea:focus, select:focus{
      border-color: rgba(18,57,255,.55);
      box-shadow: 0 0 0 4px rgba(18,57,255,.14);
    }
    textarea{ min-height: 92px; resize: vertical; }

    .hint{
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 8px;
      line-height: 1.35;
      font-weight:700;
    }

    .checklist{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      padding-top: 2px;
    }
    .check-item{
      display:flex;
      align-items:flex-start;
      gap:8px;
      font-size: 12px;
      color: #111827;
      font-weight:800;
    }
    .check-item input{ margin-top:2px; }

    .radio-group{
      display:grid;
      gap:8px;
      margin-top: 4px;
    }
    .radio-item{
      display:flex;
      gap:8px;
      align-items:flex-start;
      font-size: 12px;
      font-weight:800;
    }
    .radio-item input{ margin-top:2px; }

    table{
      width:100%;
      border-collapse: collapse;
      font-size: 12px;
      table-layout: fixed;
    }
    th, td{
      border: 1px solid var(--line);
      padding: 8px;
      vertical-align: top;
    }
    th{
      text-align:left;
      background: #f6f8ff;
      font-size: 11px;
      color: #24324a;
      font-weight: 1000;
    }
    td .mini-input{
      width:100%;
      padding: 8px;
      border: 1.5px solid var(--line);
      border-radius: 8px;
      font-size: 12px;
    }
    td .mini-input:focus{
      border-color: rgba(18,57,255,.55);
      box-shadow: 0 0 0 4px rgba(18,57,255,.14);
      outline:none;
    }

    .savebar{
      padding: 0 14px 16px;
    }
    .savebtn{
      width:100%;
      border:0;
      border-radius: 10px;
      background: linear-gradient(180deg, var(--accent) 0%, #f2c800 100%);
      color:#111827;
      font-weight: 1000;
      padding: 13px 14px;
      cursor:pointer;
      font-size: 14px;
      letter-spacing:.1px;
    }
    .savebtn:hover{ filter: brightness(1.02); }
    .savebtn:active{ transform: translateY(1px); }

    .tiny-note{
      text-align:center;
      color:#fff;
      opacity:.92;
      font-size:12px;
      font-weight:800;
      margin-top: 10px;
    }

    @media print{
      body{ background:#fff; padding:0; }
      .topbar, .tiny-note{ display:none !important; }
      .card{ box-shadow:none; border-radius:0; }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- Top Header + Language (safe, minimal) -->
    <div class="topbar">
      <div class="brand">
        <div class="brand-badge">D</div>
        <div>
          <div>D.E.Bs Learning Academy</div>
          <small data-i18n="tagline">Unlocking Brilliance Through Learning âœ¨</small>
        </div>
      </div>

      <div class="langwrap">
        <div class="langlabel">ğŸŒ <span data-i18n="language">Language</span>:</div>
        <select id="langSelect" aria-label="Language">
          <option value="en">English</option>
          <option value="es">EspaÃ±ol</option>
          <option value="fr">FranÃ§ais</option>
          <option value="zh">ä¸­æ–‡</option>
        </select>
      </div>
    </div>

    <!-- Main Card -->
    <div class="card">
      <div class="head">
        <h1 data-i18n="title">Mid-Year Student Snapshot</h1>
        <div class="sub" data-i18n="subtitle">A clear check-in for parents (no shame, just clarity ğŸ’¡)</div>
      </div>

      <div class="content">
        <form id="snapshotForm" onsubmit="return false;">

          <!-- A -->
          <div class="section">
            <div class="section-title"><span class="badge">A</span> ğŸ‘§ğŸ½ğŸ“˜ <span data-i18n="secA">Student Information</span></div>
            <div class="section-body">
              <div class="grid-2">
                <div>
                  <label for="studentName">ğŸ§’ <span data-i18n="studentName">Student Name</span>:</label>
                  <input type="text" id="studentName" required />
                </div>
                <div>
                  <label for="grade">ğŸ’ <span data-i18n="grade">Grade</span>:</label>
                  <input type="text" id="grade" required />
                </div>
                <div>
                  <label for="school">ğŸ« <span data-i18n="school">School</span>:</label>
                  <input type="text" id="school" />
                </div>
                <div>
                  <label for="teacher">ğŸ‘©ğŸ½â€ğŸ« <span data-i18n="teacher">Homeroom / Main Teacher</span>:</label>
                  <input type="text" id="teacher" />
                </div>
                <div>
                  <label for="todayDate">ğŸ“… <span data-i18n="todayDate">Todayâ€™s Date</span>:</label>
                  <input type="date" id="todayDate" />
                </div>
                <div>
                  <label for="term">ğŸ—“ï¸ <span data-i18n="term">Reporting Period (Term)</span>:</label>
                  <input type="text" id="term" placeholder="e.g., Fall 2025" data-i18n-placeholder="termPH"/>
                </div>
              </div>
            </div>
          </div>

          <!-- B -->
          <div class="section">
            <div class="section-title"><span class="badge">B</span> ğŸ˜ŠğŸ« <span data-i18n="secB">How School Feels Right Now</span></div>
            <div class="section-body">
              <div class="hint">âœ¨ <span data-i18n="b1">How does my child seem to feel about school overall? (check all that fit)</span></div>

              <div class="checklist">
                <label class="check-item">
                  <input type="checkbox" name="feelings" value="Excited most days">
                  ğŸ˜ <span data-i18n="feel1">Excited most days</span>
                </label>

                <label class="check-item">
                  <input type="checkbox" name="feelings" value="Fine / itâ€™s just school">
                  ğŸ˜ <span data-i18n="feel2">Fine / itâ€™s just school</span>
                </label>

                <label class="check-item">
                  <input type="checkbox" name="feelings" value="Anxious / nervous">
                  ğŸ˜Ÿ <span data-i18n="feel3">Anxious / nervous</span>
                </label>

                <label class="check-item">
                  <input type="checkbox" name="feelings" value="Bored / unmotivated">
                  ğŸ˜´ <span data-i18n="feel4">Bored / unmotivated</span>
                </label>

                <label class="check-item">
                  <input type="checkbox" name="feelings" value="Overwhelmed / frustrated">
                  ğŸ˜£ <span data-i18n="feel5">Overwhelmed / frustrated</span>
                </label>

                <label class="check-item">
                  <input type="checkbox" name="feelings" value="Not sure / mixed signals">
                  ğŸ¤·ğŸ½â€â™€ï¸ <span data-i18n="feel6">Not sure / mixed signals</span>
                </label>
              </div>

              <div style="height:12px;"></div>

              <div class="hint">ğŸ§  <span data-i18n="b2">How do I feel about this school year so far?</span></div>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="yearFeel" value="Mostly calm and confident">
                  ğŸ˜Œ <span data-i18n="yearFeel1">Mostly calm and confident</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="yearFeel" value="Quietly worried">
                  ğŸ˜¬ <span data-i18n="yearFeel2">Quietly worried</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="yearFeel" value="Very stressed and unsure what to do">
                  ğŸ˜° <span data-i18n="yearFeel3">Very stressed and unsure what to do</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="yearFeel" value="Mixedâ€”some things are going great, others not at all">
                  ğŸ­ <span data-i18n="yearFeel4">Mixedâ€”some things are going great, others not at all</span>
                </label>
              </div>

              <div style="height:12px;"></div>

              <label for="yearSummary">ğŸ“ <span data-i18n="yearSummary">In 1â€“2 sentences, describe this school year so far</span>:</label>
              <textarea id="yearSummary" data-i18n-placeholder="yearSummaryPH"
                placeholder="Example: The grades look okay, but homework time has become a battle and confidence is dropping."></textarea>
            </div>
          </div>

          <!-- C -->
          <div class="section">
            <div class="section-title"><span class="badge">C</span> ğŸ“Šâœï¸ <span data-i18n="secC">Quick Academic Snapshot</span></div>
            <div class="section-body">
              <div class="hint">ğŸ“Œ <span data-i18n="cHint">Use your report card, grading portal, or teacher comments.</span></div>

              <table>
                <thead>
                  <tr>
                    <th style="width: 28%;" data-i18n="thSubject">Subject</th>
                    <th style="width: 16%;" data-i18n="thGrade">Grade / Level</th>
                    <th style="width: 18%;" data-i18n="thFeel">How I Feel</th>
                    <th data-i18n="thNotes">Teacher Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><b>ğŸ“š <span data-i18n="subReading">Reading / ELA</span></b></td>
                    <td><input class="mini-input" id="c_read_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_read_feel">
                        <option value=""></option>
                        <option data-i18n="feelOpt1">Confident âœ…</option>
                        <option data-i18n="feelOpt2">Okay ğŸ™‚</option>
                        <option data-i18n="feelOpt3">Concerned ğŸ˜•</option>
                        <option data-i18n="feelOpt4">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_read_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><b>â— <span data-i18n="subMath">Math</span></b></td>
                    <td><input class="mini-input" id="c_math_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_math_feel">
                        <option value=""></option>
                        <option data-i18n="feelOpt1">Confident âœ…</option>
                        <option data-i18n="feelOpt2">Okay ğŸ™‚</option>
                        <option data-i18n="feelOpt3">Concerned ğŸ˜•</option>
                        <option data-i18n="feelOpt4">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_math_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><b>ğŸ§ª <span data-i18n="subScience">Science</span></b></td>
                    <td><input class="mini-input" id="c_sci_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_sci_feel">
                        <option value=""></option>
                        <option data-i18n="feelOpt1">Confident âœ…</option>
                        <option data-i18n="feelOpt2">Okay ğŸ™‚</option>
                        <option data-i18n="feelOpt3">Concerned ğŸ˜•</option>
                        <option data-i18n="feelOpt4">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_sci_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><b>ğŸŒ <span data-i18n="subSocial">Social Studies</span></b></td>
                    <td><input class="mini-input" id="c_ss_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_ss_feel">
                        <option value=""></option>
                        <option data-i18n="feelOpt1">Confident âœ…</option>
                        <option data-i18n="feelOpt2">Okay ğŸ™‚</option>
                        <option data-i18n="feelOpt3">Concerned ğŸ˜•</option>
                        <option data-i18n="feelOpt4">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_ss_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><input class="mini-input" id="c_other1_name" data-i18n-placeholder="otherSubPH" placeholder="Other subject..." /></td>
                    <td><input class="mini-input" id="c_other1_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_other1_feel">
                        <option value=""></option>
                        <option data-i18n="feelOpt1">Confident âœ…</option>
                        <option data-i18n="feelOpt2">Okay ğŸ™‚</option>
                        <option data-i18n="feelOpt3">Concerned ğŸ˜•</option>
                        <option data-i18n="feelOpt4">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_other1_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><input class="mini-input" id="c_other2_name" data-i18n-placeholder="otherSubPH" placeholder="Other subject..." /></td>
                    <td><input class="mini-input" id="c_other2_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_other2_feel">
                        <option value=""></option>
                        <option data-i18n="feelOpt1">Confident âœ…</option>
                        <option data-i18n="feelOpt2">Okay ğŸ™‚</option>
                        <option data-i18n="feelOpt3">Concerned ğŸ˜•</option>
                        <option data-i18n="feelOpt4">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_other2_notes" style="min-height:44px;"></textarea></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- D -->
          <div class="section">
            <div class="section-title"><span class="badge">D</span> ğŸ¯ğŸ§  <span data-i18n="secD">Behavior, Focus & Organization</span></div>
            <div class="section-body">
              <div class="hint">ğŸ« <span data-i18n="dSchool">At school (teacher comments / notes):</span></div>
              <div class="checklist">
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="Usually focused and on-task"> âœ… <span data-i18n="sb1">Usually focused and on-task</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="Needs reminders / redirection"> ğŸ” <span data-i18n="sb2">Needs reminders / redirection</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="Rushes through work"> â© <span data-i18n="sb3">Rushes through work</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="Often doesnâ€™t finish work"> ğŸ§© <span data-i18n="sb4">Often doesnâ€™t finish work</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="Behavior notes / calls home"> ğŸ“ <span data-i18n="sb5">Behavior notes / calls home</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="No major concerns reported"> ğŸ‘ <span data-i18n="sb6">No major concerns reported</span></label>
              </div>

              <div style="height:12px;"></div>

              <div class="hint">ğŸ  <span data-i18n="dHome">At home during homework / study time:</span></div>
              <div class="checklist">
                <label class="check-item"><input type="checkbox" name="homeBeh" value="Starts on their own"> ğŸš€ <span data-i18n="hb1">Starts on their own</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="Needs reminders but will do it"> â° <span data-i18n="hb2">Needs reminders but will do it</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="Fights / tears are common"> ğŸ˜­ <span data-i18n="hb3">Fights / tears are common</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="Says â€œIâ€™m dumbâ€ or â€œI canâ€™t do thisâ€"> ğŸ’” <span data-i18n="hb4">Says â€œIâ€™m dumbâ€ or â€œI canâ€™t do thisâ€</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="Avoids homework or hides assignments"> ğŸ™ˆ <span data-i18n="hb5">Avoids homework or hides assignments</span></label>
              </div>

              <div style="height:12px;"></div>

              <label for="behaviorNotes">ğŸ—’ï¸ <span data-i18n="behaviorNotes">Notes</span>:</label>
              <textarea id="behaviorNotes"></textarea>
            </div>
          </div>

          <!-- E -->
          <div class="section">
            <div class="section-title"><span class="badge">E</span> ğŸŒŸğŸ† <span data-i18n="secE">Strengths & Wins</span></div>
            <div class="section-body">
              <label for="strengthsAcademic">ğŸ“š <span data-i18n="strengthsAcademic">Academic / learning strengths</span>:</label>
              <textarea id="strengthsAcademic"></textarea>

              <div style="height:10px;"></div>

              <label for="strengthsPersonal">ğŸ’› <span data-i18n="strengthsPersonal">Personal strengths (character, talents, social skills)</span>:</label>
              <textarea id="strengthsPersonal"></textarea>

              <div style="height:10px;"></div>

              <label for="wins">ğŸ† <span data-i18n="wins">Wins from this school year (big or small)</span>:</label>
              <textarea id="wins"></textarea>
            </div>
          </div>

          <!-- F -->
          <div class="section">
            <div class="section-title"><span class="badge">F</span> âš ï¸ğŸ˜£ <span data-i18n="secF">Challenges & Worries</span></div>
            <div class="section-body">
              <label for="concernsTop">âš ï¸ <span data-i18n="concernsTop">Top concerns (academic, emotional, or behavior)</span>:</label>
              <textarea id="concernsTop"></textarea>
            </div>
          </div>

          <!-- G -->
          <div class="section">
            <div class="section-title"><span class="badge">G</span> â“ğŸ—£ï¸ <span data-i18n="secG">Questions for the School / Teacher</span></div>
            <div class="section-body">
              <label for="q1">1ï¸âƒ£ <span data-i18n="q1">Question 1</span></label>
              <textarea id="q1" style="min-height:70px;"></textarea>

              <div style="height:10px;"></div>

              <label for="q2">2ï¸âƒ£ <span data-i18n="q2">Question 2</span></label>
              <textarea id="q2" style="min-height:70px;"></textarea>

              <div style="height:10px;"></div>

              <label for="q3">3ï¸âƒ£ <span data-i18n="q3">Question 3</span></label>
              <textarea id="q3" style="min-height:70px;"></textarea>
            </div>
          </div>

          <!-- H -->
          <div class="section">
            <div class="section-title"><span class="badge">H</span> ğŸ¯ğŸ“… <span data-i18n="secH">Priority Focus for the Next 6â€“8 Weeks</span></div>
            <div class="section-body">
              <div class="hint">ğŸ¯ <span data-i18n="hHint">Over the next 6â€“8 weeks, our family will focus on:</span></div>
              <textarea id="priorityFocus"></textarea>

              <div style="height:10px;"></div>

              <label for="supportNeeded">ğŸ¤ <span data-i18n="supportNeeded">Support we need from school / D.E.Bs</span>:</label>
              <textarea id="supportNeeded"></textarea>

              <div style="height:10px;"></div>

              <div class="grid-2">
                <div>
                  <label for="signature">âœğŸ½ <span data-i18n="signature">Parent/Guardian Signature</span>:</label>
                  <input type="text" id="signature" data-i18n-placeholder="signaturePH" placeholder="Type your name" />
                </div>
                <div>
                  <label for="signDate">ğŸ“… <span data-i18n="signDate">Date</span>:</label>
                  <input type="date" id="signDate" />
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>

      <div class="savebar">
        <button class="savebtn" id="btnSaveSnapshot" type="button">ğŸ’¾ <span data-i18n="saveBtn">Save Student Snapshot</span></button>
      </div>
    </div>

    <div class="tiny-note" data-i18n="privacyNote">ğŸ”’ Your info saves to your device + is sent to D.E.Bs securely for review. No spam. No mess.</div>
  </div>

  <script>
    // ================================
    // âœ… GOOGLE SHEETS (APPS SCRIPT) URL
    // ================================
    const SHEETS_WEBAPP_URL =
      "https://script.google.com/macros/s/AKfycbwPp72sNGIDJBr4Kcy1uWi-D-qUULdRF_dlYAUnKdFnpHqDNUE265I9VYf8BzTEM0bobA/exec";

    // ================================
    // âœ… LANGUAGE (CODE ONLY): en, es, fr, zh
    // Stored in sheet as code only.
    // ================================
    let currentLang = localStorage.getItem("debs_snapshot_lang") || "en";

    // ================================
    // âœ… i18n dictionary (UI labels only)
    // ================================
    const I18N = {
      en: {
        language:"Language",
        tagline:"Unlocking Brilliance Through Learning âœ¨",
        title:"Mid-Year Student Snapshot",
        subtitle:"A clear check-in for parents (no shame, just clarity ğŸ’¡)",

        secA:"Student Information",
        studentName:"Student Name",
        grade:"Grade",
        school:"School",
        teacher:"Homeroom / Main Teacher",
        todayDate:"Todayâ€™s Date",
        term:"Reporting Period (Term)",
        termPH:"e.g., Fall 2025",

        secB:"How School Feels Right Now",
        b1:"How does my child seem to feel about school overall? (check all that fit)",
        feel1:"Excited most days",
        feel2:"Fine / itâ€™s just school",
        feel3:"Anxious / nervous",
        feel4:"Bored / unmotivated",
        feel5:"Overwhelmed / frustrated",
        feel6:"Not sure / mixed signals",
        b2:"How do I feel about this school year so far?",
        yearFeel1:"Mostly calm and confident",
        yearFeel2:"Quietly worried",
        yearFeel3:"Very stressed and unsure what to do",
        yearFeel4:"Mixedâ€”some things are going great, others not at all",
        yearSummary:"In 1â€“2 sentences, describe this school year so far",
        yearSummaryPH:"Example: The grades look okay, but homework time has become a battle and confidence is dropping.",

        secC:"Quick Academic Snapshot",
        cHint:"Use your report card, grading portal, or teacher comments.",
        thSubject:"Subject",
        thGrade:"Grade / Level",
        thFeel:"How I Feel",
        thNotes:"Teacher Notes",
        subReading:"Reading / ELA",
        subMath:"Math",
        subScience:"Science",
        subSocial:"Social Studies",
        otherSubPH:"Other subject...",
        feelOpt1:"Confident âœ…",
        feelOpt2:"Okay ğŸ™‚",
        feelOpt3:"Concerned ğŸ˜•",
        feelOpt4:"Not sure ğŸ¤·ğŸ½â€â™€ï¸",

        secD:"Behavior, Focus & Organization",
        dSchool:"At school (teacher comments / notes):",
        sb1:"Usually focused and on-task",
        sb2:"Needs reminders / redirection",
        sb3:"Rushes through work",
        sb4:"Often doesnâ€™t finish work",
        sb5:"Behavior notes / calls home",
        sb6:"No major concerns reported",
        dHome:"At home during homework / study time:",
        hb1:"Starts on their own",
        hb2:"Needs reminders but will do it",
        hb3:"Fights / tears are common",
        hb4:"Says â€œIâ€™m dumbâ€ or â€œI canâ€™t do thisâ€",
        hb5:"Avoids homework or hides assignments",
        behaviorNotes:"Notes",

        secE:"Strengths & Wins",
        strengthsAcademic:"Academic / learning strengths",
        strengthsPersonal:"Personal strengths (character, talents, social skills)",
        wins:"Wins from this school year (big or small)",

        secF:"Challenges & Worries",
        concernsTop:"Top concerns (academic, emotional, or behavior)",

        secG:"Questions for the School / Teacher",
        q1:"Question 1",
        q2:"Question 2",
        q3:"Question 3",

        secH:"Priority Focus for the Next 6â€“8 Weeks",
        hHint:"Over the next 6â€“8 weeks, our family will focus on:",
        supportNeeded:"Support we need from school / D.E.Bs",
        signature:"Parent/Guardian Signature",
        signaturePH:"Type your name",
        signDate:"Date",

        saveBtn:"Save Student Snapshot",
        privacyNote:"ğŸ”’ Your info saves to your device + is sent to D.E.Bs securely for review. No spam. No mess.",
        alertMissing:"Please enter Student Name and Grade before saving."
      },

      es: {
        language:"Idioma",
        tagline:"Desbloqueando el brillo a travÃ©s del aprendizaje âœ¨",
        title:"Resumen de Mitad de AÃ±o del Estudiante",
        subtitle:"Un chequeo claro para familias (sin culpa, solo claridad ğŸ’¡)",

        secA:"InformaciÃ³n del Estudiante",
        studentName:"Nombre del estudiante",
        grade:"Grado",
        school:"Escuela",
        teacher:"Maestro/a principal",
        todayDate:"Fecha de hoy",
        term:"PerÃ­odo (Trimestre)",
        termPH:"Ej.: OtoÃ±o 2025",

        secB:"CÃ³mo se Siente la Escuela Ahora",
        b1:"Â¿CÃ³mo parece sentirse tu hijo/a con la escuela? (marca todo lo que aplique)",
        feel1:"Emocionado/a la mayorÃ­a de los dÃ­as",
        feel2:"Bien / es solo la escuela",
        feel3:"Ansioso/a / nervioso/a",
        feel4:"Aburrido/a / sin motivaciÃ³n",
        feel5:"Abrumado/a / frustrado/a",
        feel6:"No estoy seguro/a / seÃ±ales mixtas",
        b2:"Â¿CÃ³mo me siento yo con este aÃ±o escolar?",
        yearFeel1:"Mayormente tranquilo/a y confiado/a",
        yearFeel2:"PreocupaciÃ³n silenciosa",
        yearFeel3:"Muy estresado/a y sin saber quÃ© hacer",
        yearFeel4:"Mixtoâ€”unas cosas van bien y otras no",
        yearSummary:"En 1â€“2 frases, describe este aÃ±o escolar",
        yearSummaryPH:"Ej.: Las notas se ven bien, pero la tarea es una batalla y la confianza estÃ¡ bajando.",

        secC:"Resumen AcadÃ©mico RÃ¡pido",
        cHint:"Usa boleta de calificaciones, portal o comentarios del maestro.",
        thSubject:"Materia",
        thGrade:"Nivel / Nota",
        thFeel:"CÃ³mo me siento",
        thNotes:"Notas del maestro",
        subReading:"Lectura / ELA",
        subMath:"MatemÃ¡ticas",
        subScience:"Ciencias",
        subSocial:"Estudios Sociales",
        otherSubPH:"Otra materia...",
        feelOpt1:"Con confianza âœ…",
        feelOpt2:"Bien ğŸ™‚",
        feelOpt3:"Me preocupa ğŸ˜•",
        feelOpt4:"No estoy seguro/a ğŸ¤·ğŸ½â€â™€ï¸",

        secD:"Conducta, Enfoque y OrganizaciÃ³n",
        dSchool:"En la escuela (comentarios del maestro):",
        sb1:"Generalmente enfocado/a",
        sb2:"Necesita recordatorios / redirecciÃ³n",
        sb3:"Hace el trabajo muy rÃ¡pido",
        sb4:"A menudo no termina",
        sb5:"Notas de conducta / llamadas",
        sb6:"Sin preocupaciones mayores",
        dHome:"En casa durante la tarea / estudio:",
        hb1:"Empieza solo/a",
        hb2:"Necesita recordatorios pero lo hace",
        hb3:"Peleas / lÃ¡grimas son comunes",
        hb4:"Dice â€œsoy tonto/aâ€ o â€œno puedoâ€",
        hb5:"Evita o esconde tareas",
        behaviorNotes:"Notas",

        secE:"Fortalezas y Logros",
        strengthsAcademic:"Fortalezas acadÃ©micas",
        strengthsPersonal:"Fortalezas personales (carÃ¡cter, talentos, social)",
        wins:"Logros de este aÃ±o (grandes o pequeÃ±os)",

        secF:"Retos y Preocupaciones",
        concernsTop:"Principales preocupaciones (acadÃ©micas, emocionales o conducta)",

        secG:"Preguntas para la Escuela / Maestro",
        q1:"Pregunta 1",
        q2:"Pregunta 2",
        q3:"Pregunta 3",

        secH:"Prioridades para las PrÃ³ximas 6â€“8 Semanas",
        hHint:"En las prÃ³ximas 6â€“8 semanas, nuestra familia se enfocarÃ¡ en:",
        supportNeeded:"Apoyo que necesitamos (escuela / D.E.Bs)",
        signature:"Firma del padre/madre/tutor",
        signaturePH:"Escribe tu nombre",
        signDate:"Fecha",

        saveBtn:"Guardar Resumen",
        privacyNote:"ğŸ”’ Tu info se guarda en tu dispositivo y se envÃ­a a D.E.Bs para revisiÃ³n. Sin spam.",
        alertMissing:"Por favor escribe el nombre del estudiante y el grado."
      },

      fr: {
        language:"Langue",
        tagline:"LibÃ©rer le gÃ©nie par lâ€™apprentissage âœ¨",
        title:"AperÃ§u de Mi-AnnÃ©e de lâ€™Ã‰lÃ¨ve",
        subtitle:"Un point clair pour les parents (zÃ©ro honte, juste de la clartÃ© ğŸ’¡)",

        secA:"Informations sur lâ€™Ã©lÃ¨ve",
        studentName:"Nom de lâ€™Ã©lÃ¨ve",
        grade:"Classe / Niveau",
        school:"Ã‰cole",
        teacher:"Enseignant(e) principal(e)",
        todayDate:"Date du jour",
        term:"PÃ©riode (trimestre)",
        termPH:"Ex.: Automne 2025",

        secB:"Ressenti de lâ€™Ã‰cole en Ce Moment",
        b1:"Comment votre enfant semble-t-il/elle se sentir par rapport Ã  lâ€™Ã©cole ? (cochez tout ce qui convient)",
        feel1:"Content(e) la plupart des jours",
        feel2:"Ã‡a va / câ€™est lâ€™Ã©cole",
        feel3:"Anxieux(se) / nerveux(se)",
        feel4:"Sâ€™ennuie / dÃ©motivÃ©(e)",
        feel5:"DÃ©bordÃ©(e) / frustrÃ©(e)",
        feel6:"Je ne sais pas / signaux mixtes",
        b2:"Comment je me sens par rapport Ã  cette annÃ©e scolaire ?",
        yearFeel1:"PlutÃ´t calme et confiant(e)",
        yearFeel2:"Inquiet(Ã¨te) en silence",
        yearFeel3:"TrÃ¨s stressÃ©(e), je ne sais pas quoi faire",
        yearFeel4:"MitigÃ©â€”certaines choses vont bien, dâ€™autres non",
        yearSummary:"En 1â€“2 phrases, dÃ©crivez lâ€™annÃ©e scolaire",
        yearSummaryPH:"Ex.: Les notes semblent correctes, mais les devoirs sont une bataille et la confiance baisse.",

        secC:"AperÃ§u AcadÃ©mique Rapide",
        cHint:"Utilisez le bulletin, le portail ou les commentaires de lâ€™enseignant.",
        thSubject:"MatiÃ¨re",
        thGrade:"Note / Niveau",
        thFeel:"Mon ressenti",
        thNotes:"Notes de lâ€™enseignant",
        subReading:"Lecture / ELA",
        subMath:"MathÃ©matiques",
        subScience:"Sciences",
        subSocial:"Sciences sociales",
        otherSubPH:"Autre matiÃ¨re...",
        feelOpt1:"Confiant(e) âœ…",
        feelOpt2:"Ã‡a va ğŸ™‚",
        feelOpt3:"Inquiet(Ã¨te) ğŸ˜•",
        feelOpt4:"Je ne sais pas ğŸ¤·ğŸ½â€â™€ï¸",

        secD:"Comportement, Attention & Organisation",
        dSchool:"Ã€ lâ€™Ã©cole (commentaires de lâ€™enseignant) :",
        sb1:"GÃ©nÃ©ralement concentrÃ©(e)",
        sb2:"Besoin de rappels / recentrage",
        sb3:"Travail fait trop vite",
        sb4:"Ne termine pas souvent",
        sb5:"Notes / appels Ã  la maison",
        sb6:"Pas de prÃ©occupations majeures",
        dHome:"Ã€ la maison (devoirs / Ã©tude) :",
        hb1:"Commence seul(e)",
        hb2:"Rappels nÃ©cessaires mais le fait",
        hb3:"Disputes / larmes frÃ©quentes",
        hb4:"Dit Â« je suis nul(le) Â» / Â« je nâ€™y arrive pas Â»",
        hb5:"Ã‰vite / cache les devoirs",
        behaviorNotes:"Notes",

        secE:"Forces & RÃ©ussites",
        strengthsAcademic:"Forces scolaires",
        strengthsPersonal:"Forces personnelles (caractÃ¨re, talents, social)",
        wins:"RÃ©ussites de lâ€™annÃ©e (grandes ou petites)",

        secF:"DÃ©fis & InquiÃ©tudes",
        concernsTop:"Principales inquiÃ©tudes (scolaires, Ã©motionnelles, comportement)",

        secG:"Questions pour lâ€™Ã‰cole / lâ€™Enseignant",
        q1:"Question 1",
        q2:"Question 2",
        q3:"Question 3",

        secH:"PrioritÃ©s pour les 6â€“8 Prochaines Semaines",
        hHint:"Au cours des 6â€“8 prochaines semaines, notre famille se concentre sur :",
        supportNeeded:"Soutien nÃ©cessaire (Ã©cole / D.E.Bs)",
        signature:"Signature parent/tuteur",
        signaturePH:"Tapez votre nom",
        signDate:"Date",

        saveBtn:"Enregistrer lâ€™aperÃ§u",
        privacyNote:"ğŸ”’ Vos infos sont enregistrÃ©es sur votre appareil et envoyÃ©es Ã  D.E.Bs pour examen. Pas de spam.",
        alertMissing:"Veuillez entrer le nom de lâ€™Ã©lÃ¨ve et la classe."
      },

      zh: {
        language:"è¯­è¨€",
        tagline:"ç”¨å­¦ä¹ è§£é”å“è¶Š âœ¨",
        title:"å­¦å¹´ä¸­æœŸå­¦ç”Ÿå¿«ç…§",
        subtitle:"å®¶é•¿æ¸…æ™°ç›˜ç‚¹ï¼ˆä¸æ‰¹è¯„ï¼Œåªæ±‚æ˜ç™½ ğŸ’¡ï¼‰",

        secA:"å­¦ç”Ÿä¿¡æ¯",
        studentName:"å­¦ç”Ÿå§“å",
        grade:"å¹´çº§",
        school:"å­¦æ ¡",
        teacher:"ç­ä¸»ä»»/ä¸»è¦è€å¸ˆ",
        todayDate:"ä»Šå¤©æ—¥æœŸ",
        term:"å­¦æœŸ/é˜¶æ®µ",
        termPH:"ä¾‹å¦‚ï¼š2025 ç§‹å­£",

        secB:"ç°åœ¨ä¸Šå­¦çš„æ„Ÿå—",
        b1:"å­©å­å¯¹å­¦æ ¡çš„æ€»ä½“æ„Ÿå—æ˜¯ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰",
        feel1:"å¤§å¤šæ•°æ—¥å­å¾ˆæœŸå¾…",
        feel2:"è¿˜å¥½ / å°±æ˜¯ä¸Šå­¦",
        feel3:"ç„¦è™‘ / ç´§å¼ ",
        feel4:"æ— èŠ / ç¼ºä¹åŠ¨åŠ›",
        feel5:"å‹åŠ›å¤§ / æŒ«è´¥",
        feel6:"ä¸ç¡®å®š / ä¿¡å·æ··åˆ",
        b2:"æˆ‘å¯¹è¿™ä¸ªå­¦å¹´çš„æ„Ÿå—æ˜¯ï¼Ÿ",
        yearFeel1:"æ€»ä½“å¹³é™ä¸”æœ‰ä¿¡å¿ƒ",
        yearFeel2:"æœ‰ç‚¹æ‹…å¿ƒ",
        yearFeel3:"å¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠ",
        yearFeel4:"å¤æ‚â€”æœ‰çš„å¾ˆå¥½ï¼Œæœ‰çš„å¾ˆç³Ÿ",
        yearSummary:"ç”¨1â€“2å¥è¯æè¿°æœ¬å­¦å¹´è‡³ä»Šæƒ…å†µ",
        yearSummaryPH:"ä¾‹å¦‚ï¼šæˆç»©çœ‹èµ·æ¥è¿˜è¡Œï¼Œä½†åšä½œä¸šå˜æˆäº†å¤§æˆ˜ï¼Œä¿¡å¿ƒåœ¨ä¸‹é™ã€‚",

        secC:"å­¦ä¸šå¿«é€Ÿæ¦‚è§ˆ",
        cHint:"å¯å‚è€ƒæˆç»©å•ã€å®¶é•¿å¹³å°æˆ–è€å¸ˆè¯„è¯­ã€‚",
        thSubject:"ç§‘ç›®",
        thGrade:"æˆç»©/æ°´å¹³",
        thFeel:"æˆ‘çš„æ„Ÿå—",
        thNotes:"è€å¸ˆå¤‡æ³¨",
        subReading:"é˜…è¯»/è‹±è¯­",
        subMath:"æ•°å­¦",
        subScience:"ç§‘å­¦",
        subSocial:"ç¤¾ä¼šç§‘å­¦",
        otherSubPH:"å…¶ä»–ç§‘ç›®...",
        feelOpt1:"å¾ˆæœ‰ä¿¡å¿ƒ âœ…",
        feelOpt2:"è¿˜å¯ä»¥ ğŸ™‚",
        feelOpt3:"æœ‰ç‚¹æ‹…å¿ƒ ğŸ˜•",
        feelOpt4:"ä¸ç¡®å®š ğŸ¤·ğŸ½â€â™€ï¸",

        secD:"è¡Œä¸ºã€ä¸“æ³¨ä¸ç»„ç»‡",
        dSchool:"åœ¨å­¦æ ¡ï¼ˆè€å¸ˆåé¦ˆï¼‰ï¼š",
        sb1:"é€šå¸¸ä¸“æ³¨åœ¨ä»»åŠ¡ä¸Š",
        sb2:"éœ€è¦æé†’/çº æ­£",
        sb3:"åšé¢˜å¤ªå¿«",
        sb4:"ç»å¸¸åšä¸å®Œ",
        sb5:"è¡Œä¸ºè®°å½•/ç”µè¯",
        sb6:"æ²¡æœ‰æ˜æ˜¾é—®é¢˜",
        dHome:"åœ¨å®¶ï¼ˆä½œä¸š/å­¦ä¹ ï¼‰ï¼š",
        hb1:"èƒ½ä¸»åŠ¨å¼€å§‹",
        hb2:"éœ€è¦æé†’ä½†èƒ½å®Œæˆ",
        hb3:"äº‰åµ/å“­é—¹å¸¸è§",
        hb4:"è¯´â€œæˆ‘å¾ˆç¬¨/æˆ‘ä¸è¡Œâ€",
        hb5:"é€ƒé¿æˆ–è—ä½œä¸š",
        behaviorNotes:"å¤‡æ³¨",

        secE:"ä¼˜åŠ¿ä¸æ”¶è·",
        strengthsAcademic:"å­¦ä¸š/å­¦ä¹ ä¼˜åŠ¿",
        strengthsPersonal:"ä¸ªäººä¼˜åŠ¿ï¼ˆå“æ ¼ã€ç‰¹é•¿ã€ç¤¾äº¤ï¼‰",
        wins:"æœ¬å­¦å¹´æ”¶è·ï¼ˆå¤§å°éƒ½ç®—ï¼‰",

        secF:"æŒ‘æˆ˜ä¸æ‹…å¿§",
        concernsTop:"ä¸»è¦æ‹…å¿§ï¼ˆå­¦ä¸š/æƒ…ç»ª/è¡Œä¸ºï¼‰",

        secG:"ç»™å­¦æ ¡/è€å¸ˆçš„é—®é¢˜",
        q1:"é—®é¢˜ 1",
        q2:"é—®é¢˜ 2",
        q3:"é—®é¢˜ 3",

        secH:"æœªæ¥6â€“8å‘¨é‡ç‚¹æ–¹å‘",
        hHint:"æœªæ¥6â€“8å‘¨ï¼Œæˆ‘ä»¬å®¶åº­å°†é‡ç‚¹å…³æ³¨ï¼š",
        supportNeeded:"éœ€è¦çš„æ”¯æŒï¼ˆå­¦æ ¡ / D.E.Bsï¼‰",
        signature:"å®¶é•¿/ç›‘æŠ¤äººç­¾å",
        signaturePH:"è¾“å…¥ä½ çš„åå­—",
        signDate:"æ—¥æœŸ",

        saveBtn:"ä¿å­˜å­¦ç”Ÿå¿«ç…§",
        privacyNote:"ğŸ”’ ä¿¡æ¯ä¼šä¿å­˜åœ¨ä½ çš„è®¾å¤‡å¹¶å‘é€ç»™D.E.Bsç”¨äºæŸ¥çœ‹ï¼ˆæ— åƒåœ¾ä¿¡æ¯ï¼‰ã€‚",
        alertMissing:"è¯·å…ˆå¡«å†™å­¦ç”Ÿå§“åå’Œå¹´çº§ã€‚"
      }
    };

    // ================================
    // âœ… Helpers
    // ================================
    const $ = (id) => document.getElementById(id);

    function getCheckedValues(name){
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(x=>x.value);
    }
    function getRadioValue(name){
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : "";
    }

    // ================================
    // âœ… Apply translations to UI
    // ================================
    function applyTranslations(){
      const t = I18N[currentLang] || I18N.en;

      // text nodes
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        if(t[key] !== undefined) el.textContent = t[key];
      });

      // placeholders
      document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
        const key = el.getAttribute("data-i18n-placeholder");
        if(t[key] !== undefined) el.setAttribute("placeholder", t[key]);
      });

      // select options (feel options)
      document.querySelectorAll("option[data-i18n]").forEach(opt=>{
        const key = opt.getAttribute("data-i18n");
        if(t[key] !== undefined) opt.textContent = t[key];
      });

      // update html lang attribute
      document.documentElement.lang = currentLang;

      // persist
      localStorage.setItem("debs_snapshot_lang", currentLang);
    }

    // ================================
    // âœ… Collect ALL form data (with lang code only)
    // ================================
    function collectForm(){
      return {
        _lang: currentLang,

        studentName: $("studentName")?.value?.trim() || "",
        grade: $("grade")?.value?.trim() || "",
        school: $("school")?.value?.trim() || "",
        teacher: $("teacher")?.value?.trim() || "",
        todayDate: $("todayDate")?.value || "",
        term: $("term")?.value?.trim() || "",

        feelings: getCheckedValues("feelings"),
        yearFeel: getRadioValue("yearFeel"),
        yearSummary: $("yearSummary")?.value?.trim() || "",

        academic: {
          reading: { grade: $("c_read_grade")?.value?.trim() || "", feel: $("c_read_feel")?.value || "", notes: $("c_read_notes")?.value?.trim() || "" },
          math:    { grade: $("c_math_grade")?.value?.trim() || "", feel: $("c_math_feel")?.value || "", notes: $("c_math_notes")?.value?.trim() || "" },
          science: { grade: $("c_sci_grade")?.value?.trim() || "", feel: $("c_sci_feel")?.value || "", notes: $("c_sci_notes")?.value?.trim() || "" },
          social:  { grade: $("c_ss_grade")?.value?.trim() || "", feel: $("c_ss_feel")?.value || "", notes: $("c_ss_notes")?.value?.trim() || "" },
          other1:  { name: $("c_other1_name")?.value?.trim() || "", grade: $("c_other1_grade")?.value?.trim() || "", feel: $("c_other1_feel")?.value || "", notes: $("c_other1_notes")?.value?.trim() || "" },
          other2:  { name: $("c_other2_name")?.value?.trim() || "", grade: $("c_other2_grade")?.value?.trim() || "", feel: $("c_other2_feel")?.value || "", notes: $("c_other2_notes")?.value?.trim() || "" }
        },

        schoolBeh: getCheckedValues("schoolBeh"),
        homeBeh: getCheckedValues("homeBeh"),
        behaviorNotes: $("behaviorNotes")?.value?.trim() || "",

        strengthsAcademic: $("strengthsAcademic")?.value?.trim() || "",
        strengthsPersonal: $("strengthsPersonal")?.value?.trim() || "",
        wins: $("wins")?.value?.trim() || "",

        concernsTop: $("concernsTop")?.value?.trim() || "",

        questions: {
          q1: $("q1")?.value?.trim() || "",
          q2: $("q2")?.value?.trim() || "",
          q3: $("q3")?.value?.trim() || ""
        },

        priorityFocus: $("priorityFocus")?.value?.trim() || "",
        supportNeeded: $("supportNeeded")?.value?.trim() || "",

        signature: $("signature")?.value?.trim() || "",
        signDate: $("signDate")?.value || "",

        _savedAt: new Date().toISOString(),
        submissionId: (crypto && crypto.randomUUID) ? crypto.randomUUID() : `${Date.now()}-${Math.random().toString(16).slice(2)}`
      };
    }

    // ================================
    // âœ… Send to Google Sheets (Apps Script)
    // Also sends legacy fields for compatibility with older doPost versions.
    // ================================
    async function sendToGoogleSheet(snapshotData){
      const body = new URLSearchParams();

      // Full JSON (best)
      body.append("payload", JSON.stringify(snapshotData));

      // Key columns (nice + readable)
      body.append("studentName", snapshotData.studentName || "");
      body.append("grade", snapshotData.grade || "");
      body.append("school", snapshotData.school || "");
      body.append("teacher", snapshotData.teacher || "");
      body.append("term", snapshotData.term || "");
      body.append("todayDate", snapshotData.todayDate || "");
      body.append("lang", snapshotData._lang || "en");

      // Legacy compatibility (in case an older doPost is still live)
      body.append("period", snapshotData.term || "");
      body.append("date", snapshotData.todayDate || "");
      body.append("yearDescription", snapshotData.yearSummary || "");
      body.append("strengths", `${snapshotData.strengthsAcademic || ""}\n${snapshotData.strengthsPersonal || ""}\nWins: ${snapshotData.wins || ""}`);
      body.append("concerns", snapshotData.concernsTop || "");
      body.append("attendance", ""); // not used in this version
      body.append("behavior", snapshotData.behaviorNotes || "");
      body.append("parentComments", "");
      body.append("additionalNotes", snapshotData.supportNeeded || "");

      // no-cors prevents browser blocking on GitHub Pages
      await fetch(SHEETS_WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
        body: body.toString()
      });
    }

    // ================================
    // âœ… Save â†’ Send â†’ Confirmation
    // ================================
    async function saveSnapshotAndGo(){
      const t = I18N[currentLang] || I18N.en;
      const data = collectForm();

      if(!data.studentName || !data.grade){
        alert(t.alertMissing || "Please enter Student Name and Grade before saving.");
        return;
      }

      // Save locally (so confirmation can read it even if internet is flaky)
      localStorage.setItem("debs_midyear_last_snapshot_v1", JSON.stringify(data));

      // Disable button to prevent double clicks
      const btn = $("btnSaveSnapshot");
      if(btn){
        btn.disabled = true;
        btn.style.opacity = "0.85";
        btn.innerText = (currentLang==="zh") ? "æ­£åœ¨ä¿å­˜â€¦ â³" : "Savingâ€¦ â³";
      }

      // Post to sheet (even if it fails, we still redirect)
      try { await sendToGoogleSheet(data); } catch(e){ console.error(e); }

      // Redirect to confirmation.html with language + submission id
      window.location.href = `confirmation.html?lang=${encodeURIComponent(data._lang || "en")}&sid=${encodeURIComponent(data.submissionId)}`;
    }

    // ================================
    // âœ… Boot
    // ================================
    document.addEventListener("DOMContentLoaded", ()=>{
      // set language selector to saved/default
      const select = $("langSelect");
      if(select){
        select.value = currentLang;
        select.addEventListener("change", (e)=>{
          currentLang = e.target.value;
          applyTranslations();
        });
      }

      applyTranslations();

      const saveBtn = $("btnSaveSnapshot");
      if(saveBtn) saveBtn.addEventListener("click", saveSnapshotAndGo);
    });
  </script>
</body>
</html>
