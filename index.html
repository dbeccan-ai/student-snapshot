<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mid-Year Student Snapshot | D.E.Bs Learning Academy</title>
  <style>
    :root{
      --bg:#6c67c9;
      --bg-dark:#5e58be;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --line:#dbe4f2;
      --bar:#6b63c6;
      --bar-dark:#544db4;
      --accent:#ffde59;
      --radius:10px;
      --radius2:8px;
      --shadow:0 18px 45px rgba(0,0,0,.22);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--font);
      background: linear-gradient(180deg, var(--bg) 0%, var(--bg-dark) 100%);
      color:var(--ink);
      min-height:100vh;
      padding: 24px 12px 60px;
    }
    .container{ max-width: 760px; margin: 0 auto; }
    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.05);
    }
    .head{
      padding: 18px 18px 10px;
      text-align:center;
      position: relative;
    }
    .lang{
      position:absolute;
      right: 12px;
      top: 12px;
      display:flex;
      gap:8px;
      align-items:center;
      font-size: 12px;
      color: var(--muted);
    }
    .lang select{
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 800;
      font-size: 12px;
      background:#fff;
      cursor:pointer;
    }
    .head h1{ margin:0; font-size: 18px; font-weight: 900; letter-spacing: .2px; }
    .head .sub{ margin: 4px 0 0; font-size: 11px; color: var(--muted); font-style: italic; }

    .content{ padding: 12px 14px 16px; }

    .section{
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      margin-bottom: 12px;
      overflow:hidden;
      background:#fff;
    }
    .section-title{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--bar) 0%, var(--bar-dark) 100%);
      color:#fff;
      font-weight: 900;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .badge{
      width:18px;height:18px;
      border-radius:4px;
      background: rgba(255,255,255,.18);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size: 11px;
      font-weight: 900;
    }
    .section-body{ padding: 12px; }

    .grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 720px){ .grid-2{ grid-template-columns: 1fr; } .lang{ position: static; justify-content: center; margin-bottom: 10px; } }

    label{ display:block; font-size: 11px; font-weight: 900; color: #1f2937; margin: 0 0 6px; }
    input[type="text"], input[type="date"], textarea, select{
      width:100%;
      padding: 10px 10px;
      border: 1.5px solid var(--line);
      border-radius: 6px;
      font-size: 12px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
      background:#fff;
    }
    input:focus, textarea:focus, select:focus{
      border-color: rgba(107,99,198,.6);
      box-shadow: 0 0 0 4px rgba(107,99,198,.14);
    }
    textarea{ min-height: 92px; resize: vertical; }

    .hint{ font-size: 11px; color: var(--muted); margin-bottom: 8px; line-height: 1.35; }
    .checklist{ display:grid; grid-template-columns: 1fr; gap:8px; padding-top: 2px; }
    .check-item, .radio-item{
      display:flex; align-items:flex-start; gap:8px; font-size: 12px; color: #111827;
    }
    .check-item input, .radio-item input{ margin-top:2px; }
    .radio-group{ display:grid; gap:8px; margin-top: 4px; }

    table{ width:100%; border-collapse: collapse; font-size: 12px; table-layout: fixed; }
    th, td{ border: 1px solid var(--line); padding: 8px; vertical-align: top; }
    th{ text-align:left; background: #f6f8ff; font-size: 11px; color: #24324a; font-weight: 900; }
    td .mini-input{
      width:100%;
      padding: 8px;
      border: 1.5px solid var(--line);
      border-radius: 6px;
      font-size: 12px;
    }
    td .mini-input:focus{
      border-color: rgba(107,99,198,.6);
      box-shadow: 0 0 0 4px rgba(107,99,198,.14);
      outline:none;
    }

    .savebar{ padding: 0 14px 16px; }
    .savebtn{
      width:100%;
      border:0;
      border-radius: 6px;
      background: linear-gradient(180deg, var(--bar) 0%, var(--bar-dark) 100%);
      color:#fff;
      font-weight: 900;
      padding: 12px 14px;
      cursor:pointer;
      font-size: 13px;
    }
    .savebtn:hover{ filter: brightness(1.02); }
    .savebtn:active{ transform: translateY(1px); }

    @media print{
      body{ background:#fff; padding:0; }
      .lang{ display:none !important; }
      .card{ box-shadow:none; border-radius:0; }
      .savebar{ display:none !important; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="head">
        <div class="lang">
          <span data-i18n="langLabel">Language</span>
          <select id="langSelect" aria-label="Language">
            <option value="en">English</option>
            <option value="es">EspaÃ±ol</option>
            <option value="fr">FranÃ§ais</option>
            <option value="zh">ä¸­æ–‡</option>
          </select>
        </div>

        <h1 data-i18n="title">Mid-Year Student Snapshot</h1>
        <div class="sub" data-i18n="subtitle">Parent Power Circle â€¢ D.E.Bs Learning Academy</div>
      </div>

      <div class="content">
        <form id="snapshotForm">

          <!-- A -->
          <div class="section">
            <div class="section-title"><span class="badge">A</span> <span data-i18n="secA">ğŸ‘§ğŸ½ğŸ“˜ Student Information</span></div>
            <div class="section-body">
              <div class="grid-2">
                <div>
                  <label for="studentName" data-i18n="studentName">Student Name:</label>
                  <input type="text" id="studentName" required />
                </div>
                <div>
                  <label for="grade" data-i18n="grade">Grade:</label>
                  <input type="text" id="grade" required />
                </div>
                <div>
                  <label for="school" data-i18n="school">School:</label>
                  <input type="text" id="school" />
                </div>
                <div>
                  <label for="teacher" data-i18n="teacher">Homeroom / Main Teacher:</label>
                  <input type="text" id="teacher" />
                </div>
                <div>
                  <label for="todayDate" data-i18n="todayDate">Today's Date:</label>
                  <input type="date" id="todayDate" />
                </div>
                <div>
                  <label for="term" data-i18n="term">Reporting Period (Term):</label>
                  <input type="text" id="term" placeholder="e.g., Fall 2025" data-i18n-placeholder="termPh"/>
                </div>
              </div>
            </div>
          </div>

          <!-- B -->
          <div class="section">
            <div class="section-title"><span class="badge">B</span> <span data-i18n="secB">ğŸ˜ŠğŸ« How School Feels Right Now</span></div>
            <div class="section-body">
              <div class="hint"><b>1ï¸âƒ£</b> <span data-i18n="b1">How does my child seem to feel about school overall? (check all that fit)</span></div>
              <div class="checklist">
                <label class="check-item"><input type="checkbox" name="feelings" value="excited"> <span data-i18n="feel_excited">ğŸ˜ Excited most days</span></label>
                <label class="check-item"><input type="checkbox" name="feelings" value="fine"> <span data-i18n="feel_fine">ğŸ˜ Fine / itâ€™s just school</span></label>
                <label class="check-item"><input type="checkbox" name="feelings" value="anxious"> <span data-i18n="feel_anxious">ğŸ˜Ÿ Anxious / nervous</span></label>
                <label class="check-item"><input type="checkbox" name="feelings" value="bored"> <span data-i18n="feel_bored">ğŸ˜´ Bored / unmotivated</span></label>
                <label class="check-item"><input type="checkbox" name="feelings" value="overwhelmed"> <span data-i18n="feel_overwhelmed">ğŸ˜£ Overwhelmed / frustrated</span></label>
                <label class="check-item"><input type="checkbox" name="feelings" value="not_sure"> <span data-i18n="feel_not_sure">ğŸ¤·ğŸ½â€â™€ï¸ Not sure / mixed signals</span></label>
              </div>

              <div style="height:10px;"></div>

              <div class="hint"><b>2ï¸âƒ£</b> <span data-i18n="b2">How do I feel about this school year so far?</span></div>
              <div class="radio-group">
                <label class="radio-item"><input type="radio" name="yearFeel" value="calm"> <span data-i18n="year_calm">ğŸ˜Œ Mostly calm and confident</span></label>
                <label class="radio-item"><input type="radio" name="yearFeel" value="worried"> <span data-i18n="year_worried">ğŸ˜¬ Quietly worried</span></label>
                <label class="radio-item"><input type="radio" name="yearFeel" value="stressed"> <span data-i18n="year_stressed">ğŸ˜° Very stressed and unsure what to do</span></label>
                <label class="radio-item"><input type="radio" name="yearFeel" value="mixed"> <span data-i18n="year_mixed">ğŸ­ Mixedâ€”some things are going great, others not at all</span></label>
              </div>

              <div style="height:10px;"></div>

              <label for="yearSummary" data-i18n="yearSummaryLabel">ğŸ“ In one or two sentences, describe this school year so far:</label>
              <textarea id="yearSummary" data-i18n-placeholder="yearSummaryPh" placeholder="Example: The grades look okay, but homework time has become a battle and confidence is dropping."></textarea>
            </div>
          </div>

          <!-- C -->
          <div class="section">
            <div class="section-title"><span class="badge">C</span> <span data-i18n="secC">ğŸ“Šâœï¸ Quick Academic Snapshot</span></div>
            <div class="section-body">
              <div class="hint" data-i18n="cHint">ğŸ“Œ Use your report card, grading portal, or teacher comments to fill this in.</div>

              <table>
                <thead>
                  <tr>
                    <th style="width: 28%;" data-i18n="cSubject">Subject</th>
                    <th style="width: 16%;" data-i18n="cGradeLevel">Grade / Level</th>
                    <th style="width: 18%;" data-i18n="cHowIFeel">How I Feel</th>
                    <th data-i18n="cTeacherNotes">Teacher Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><b data-i18n="cReading">Reading / ELA</b></td>
                    <td><input class="mini-input" id="c_read_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_read_feel">
                        <option value=""></option>
                        <option value="confident" data-i18n="feel_confident">Confident âœ…</option>
                        <option value="okay" data-i18n="feel_okay">Okay ğŸ™‚</option>
                        <option value="concerned" data-i18n="feel_concerned">Concerned ğŸ˜•</option>
                        <option value="not_sure" data-i18n="feel_notsure">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_read_notes" style="min-height:44px;"></textarea></td>
                  </tr>
                  <tr>
                    <td><b data-i18n="cMath">Math</b></td>
                    <td><input class="mini-input" id="c_math_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_math_feel">
                        <option value=""></option>
                        <option value="confident" data-i18n="feel_confident">Confident âœ…</option>
                        <option value="okay" data-i18n="feel_okay">Okay ğŸ™‚</option>
                        <option value="concerned" data-i18n="feel_concerned">Concerned ğŸ˜•</option>
                        <option value="not_sure" data-i18n="feel_notsure">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_math_notes" style="min-height:44px;"></textarea></td>
                  </tr>
                  <tr>
                    <td><b data-i18n="cScience">Science</b></td>
                    <td><input class="mini-input" id="c_sci_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_sci_feel">
                        <option value=""></option>
                        <option value="confident" data-i18n="feel_confident">Confident âœ…</option>
                        <option value="okay" data-i18n="feel_okay">Okay ğŸ™‚</option>
                        <option value="concerned" data-i18n="feel_concerned">Concerned ğŸ˜•</option>
                        <option value="not_sure" data-i18n="feel_notsure">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_sci_notes" style="min-height:44px;"></textarea></td>
                  </tr>
                  <tr>
                    <td><b data-i18n="cSocial">Social Studies</b></td>
                    <td><input class="mini-input" id="c_ss_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_ss_feel">
                        <option value=""></option>
                        <option value="confident" data-i18n="feel_confident">Confident âœ…</option>
                        <option value="okay" data-i18n="feel_okay">Okay ğŸ™‚</option>
                        <option value="concerned" data-i18n="feel_concerned">Concerned ğŸ˜•</option>
                        <option value="not_sure" data-i18n="feel_notsure">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_ss_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><input class="mini-input" id="c_other1_name" placeholder="Other subject..." data-i18n-placeholder="otherSubjectPh"/></td>
                    <td><input class="mini-input" id="c_other1_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_other1_feel">
                        <option value=""></option>
                        <option value="confident" data-i18n="feel_confident">Confident âœ…</option>
                        <option value="okay" data-i18n="feel_okay">Okay ğŸ™‚</option>
                        <option value="concerned" data-i18n="feel_concerned">Concerned ğŸ˜•</option>
                        <option value="not_sure" data-i18n="feel_notsure">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_other1_notes" style="min-height:44px;"></textarea></td>
                  </tr>

                  <tr>
                    <td><input class="mini-input" id="c_other2_name" placeholder="Other subject..." data-i18n-placeholder="otherSubjectPh"/></td>
                    <td><input class="mini-input" id="c_other2_grade" /></td>
                    <td>
                      <select class="mini-input" id="c_other2_feel">
                        <option value=""></option>
                        <option value="confident" data-i18n="feel_confident">Confident âœ…</option>
                        <option value="okay" data-i18n="feel_okay">Okay ğŸ™‚</option>
                        <option value="concerned" data-i18n="feel_concerned">Concerned ğŸ˜•</option>
                        <option value="not_sure" data-i18n="feel_notsure">Not sure ğŸ¤·ğŸ½â€â™€ï¸</option>
                      </select>
                    </td>
                    <td><textarea class="mini-input" id="c_other2_notes" style="min-height:44px;"></textarea></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- D -->
          <div class="section">
            <div class="section-title"><span class="badge">D</span> <span data-i18n="secD">ğŸ¯ğŸ§  Behavior, Focus & Organization</span></div>
            <div class="section-body">
              <div class="hint"><b data-i18n="dAtSchoolTitle">ğŸ« At school</b> <span data-i18n="dAtSchoolNote">(teacher comments / notes):</span></div>
              <div class="checklist">
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="focused"> <span data-i18n="sb_focused">âœ… Usually focused and on-task</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="needs_reminders"> <span data-i18n="sb_reminders">ğŸ” Needs reminders / redirection</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="rushes"> <span data-i18n="sb_rushes">â© Rushes through work</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="not_finish"> <span data-i18n="sb_notfinish">ğŸ§© Often doesnâ€™t finish work</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="calls_home"> <span data-i18n="sb_calls">ğŸ“ Behavior notes / calls home</span></label>
                <label class="check-item"><input type="checkbox" name="schoolBeh" value="no_concerns"> <span data-i18n="sb_noconcerns">ğŸ‘ No major concerns reported</span></label>
              </div>

              <div style="height:10px;"></div>

              <div class="hint"><b data-i18n="dAtHomeTitle">ğŸ  At home during homework / study time</b>:</div>
              <div class="checklist">
                <label class="check-item"><input type="checkbox" name="homeBeh" value="starts_alone"> <span data-i18n="hb_starts">ğŸš€ Starts on their own</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="needs_reminders"> <span data-i18n="hb_reminders">â° Needs reminders but will do it</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="tears"> <span data-i18n="hb_tears">ğŸ˜­ Fights / tears are common</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="negative_self_talk"> <span data-i18n="hb_neg">ğŸ’” Says â€œIâ€™m dumbâ€ or â€œI canâ€™t do thisâ€</span></label>
                <label class="check-item"><input type="checkbox" name="homeBeh" value="avoids"> <span data-i18n="hb_avoids">ğŸ™ˆ Avoids homework or hides assignments</span></label>
              </div>

              <div style="height:10px;"></div>

              <label for="behaviorNotes" data-i18n="behaviorNotesLabel">ğŸ—’ï¸ Notes:</label>
              <textarea id="behaviorNotes"></textarea>
            </div>
          </div>

          <!-- E -->
          <div class="section">
            <div class="section-title"><span class="badge">E</span> <span data-i18n="secE">ğŸŒŸğŸ† Strengths & Wins</span></div>
            <div class="section-body">
              <label for="strengthsAcademic" data-i18n="strengthsAcademic">ğŸ“š Academic / learning strengths:</label>
              <textarea id="strengthsAcademic"></textarea>

              <div style="height:10px;"></div>

              <label for="strengthsPersonal" data-i18n="strengthsPersonal">ğŸ’› Personal strengths (character, talents, social skills):</label>
              <textarea id="strengthsPersonal"></textarea>

              <div style="height:10px;"></div>

              <label for="wins" data-i18n="wins">ğŸ† Wins from this school year (big or small):</label>
              <textarea id="wins"></textarea>
            </div>
          </div>

          <!-- F -->
          <div class="section">
            <div class="section-title"><span class="badge">F</span> <span data-i18n="secF">âš ï¸ğŸ˜£ Challenges & Worries</span></div>
            <div class="section-body">
              <label for="concernsTop" data-i18n="concernsTop">âš ï¸ Top concerns (academic, emotional, or behavior):</label>
              <textarea id="concernsTop"></textarea>
            </div>
          </div>

          <!-- G -->
          <div class="section">
            <div class="section-title"><span class="badge">G</span> <span data-i18n="secG">â“ğŸ—£ï¸ Questions for the School / Teacher</span></div>
            <div class="section-body">
              <label for="q1">1ï¸âƒ£</label>
              <textarea id="q1" style="min-height:70px;"></textarea>
              <div style="height:10px;"></div>
              <label for="q2">2ï¸âƒ£</label>
              <textarea id="q2" style="min-height:70px;"></textarea>
              <div style="height:10px;"></div>
              <label for="q3">3ï¸âƒ£</label>
              <textarea id="q3" style="min-height:70px;"></textarea>
            </div>
          </div>

          <!-- H -->
          <div class="section">
            <div class="section-title"><span class="badge">H</span> <span data-i18n="secH">ğŸ¯ğŸ“… Priority Focus for the Next 6â€“8 Weeks</span></div>
            <div class="section-body">
              <div class="hint"><b data-i18n="hTop">ğŸ¯ Top 1â€“3 focus areas (write here):</b><br/><span data-i18n="hSub">Over the next 6â€“8 weeks, our family will focus on:</span></div>
              <textarea id="priorityFocus"></textarea>

              <div style="height:10px;"></div>

              <label for="supportNeeded" data-i18n="supportNeeded">ğŸ¤ Support we need from school / D.E.Bs:</label>
              <textarea id="supportNeeded"></textarea>

              <div style="height:10px;"></div>

              <div class="grid-2">
                <div>
                  <label for="signature" data-i18n="signature">âœğŸ½ Parent/Guardian Signature:</label>
                  <input type="text" id="signature" placeholder="Type your name" data-i18n-placeholder="signaturePh"/>
                </div>
                <div>
                  <label for="signDate" data-i18n="signDate">ğŸ“… Date:</label>
                  <input type="date" id="signDate" />
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>

      <div class="savebar">
        <button class="savebtn" id="btnSaveSnapshot" type="button" data-i18n="saveBtn">ğŸ’¾ Save Student Snapshot</button>
      </div>
    </div>
  </div>

  <script>
    // ================================
    // âœ… SETTINGS
    // ================================
    const STORAGE_SNAPSHOT_KEY = "debs_midyear_last_snapshot_v1";
    const STORAGE_DRAFT_KEY    = "debs_midyear_draft_v1";
    const STORAGE_LANG_KEY     = "debs_midyear_lang_v1";

    // âœ… GOOGLE SHEETS (APPS SCRIPT) URL (replace if you deploy a new one)
    const SHEETS_WEBAPP_URL =
      "https://script.google.com/macros/s/AKfycbwPp72sNGIDJBr4Kcy1uWi-D-qUULdRF_dlYAUnKdFnpHqDNUE265I9VYf8BzTEM0bobA/exec";

    // ================================
    // âœ… I18N (EN / ES / FR / ZH)
    // ================================
    const I18N = {
      en: {
        langLabel:"Language",
        title:"Mid-Year Student Snapshot",
        subtitle:"Parent Power Circle â€¢ D.E.Bs Learning Academy",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ Student Information",
        secB:"ğŸ˜ŠğŸ« How School Feels Right Now",
        secC:"ğŸ“Šâœï¸ Quick Academic Snapshot",
        secD:"ğŸ¯ğŸ§  Behavior, Focus & Organization",
        secE:"ğŸŒŸğŸ† Strengths & Wins",
        secF:"âš ï¸ğŸ˜£ Challenges & Worries",
        secG:"â“ğŸ—£ï¸ Questions for the School / Teacher",
        secH:"ğŸ¯ğŸ“… Priority Focus for the Next 6â€“8 Weeks",

        studentName:"Student Name:",
        grade:"Grade:",
        school:"School:",
        teacher:"Homeroom / Main Teacher:",
        todayDate:"Today's Date:",
        term:"Reporting Period (Term):",
        termPh:"e.g., Fall 2025",

        b1:"How does my child seem to feel about school overall? (check all that fit)",
        b2:"How do I feel about this school year so far?",
        yearSummaryLabel:"ğŸ“ In one or two sentences, describe this school year so far:",
        yearSummaryPh:"Example: The grades look okay, but homework time has become a battle and confidence is dropping.",

        feel_excited:"ğŸ˜ Excited most days",
        feel_fine:"ğŸ˜ Fine / itâ€™s just school",
        feel_anxious:"ğŸ˜Ÿ Anxious / nervous",
        feel_bored:"ğŸ˜´ Bored / unmotivated",
        feel_overwhelmed:"ğŸ˜£ Overwhelmed / frustrated",
        feel_not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ Not sure / mixed signals",

        year_calm:"ğŸ˜Œ Mostly calm and confident",
        year_worried:"ğŸ˜¬ Quietly worried",
        year_stressed:"ğŸ˜° Very stressed and unsure what to do",
        year_mixed:"ğŸ­ Mixedâ€”some things are going great, others not at all",

        cHint:"ğŸ“Œ Use your report card, grading portal, or teacher comments to fill this in.",
        cSubject:"Subject",
        cGradeLevel:"Grade / Level",
        cHowIFeel:"How I Feel",
        cTeacherNotes:"Teacher Notes",
        cReading:"Reading / ELA",
        cMath:"Math",
        cScience:"Science",
        cSocial:"Social Studies",
        otherSubjectPh:"Other subject...",

        feel_confident:"Confident âœ…",
        feel_okay:"Okay ğŸ™‚",
        feel_concerned:"Concerned ğŸ˜•",
        feel_notsure:"Not sure ğŸ¤·ğŸ½â€â™€ï¸",

        dAtSchoolTitle:"ğŸ« At school",
        dAtSchoolNote:"(teacher comments / notes):",
        dAtHomeTitle:"ğŸ  At home during homework / study time",

        sb_focused:"âœ… Usually focused and on-task",
        sb_reminders:"ğŸ” Needs reminders / redirection",
        sb_rushes:"â© Rushes through work",
        sb_notfinish:"ğŸ§© Often doesnâ€™t finish work",
        sb_calls:"ğŸ“ Behavior notes / calls home",
        sb_noconcerns:"ğŸ‘ No major concerns reported",

        hb_starts:"ğŸš€ Starts on their own",
        hb_reminders:"â° Needs reminders but will do it",
        hb_tears:"ğŸ˜­ Fights / tears are common",
        hb_neg:"ğŸ’” Says â€œIâ€™m dumbâ€ or â€œI canâ€™t do thisâ€",
        hb_avoids:"ğŸ™ˆ Avoids homework or hides assignments",

        behaviorNotesLabel:"ğŸ—’ï¸ Notes:",
        strengthsAcademic:"ğŸ“š Academic / learning strengths:",
        strengthsPersonal:"ğŸ’› Personal strengths (character, talents, social skills):",
        wins:"ğŸ† Wins from this school year (big or small):",
        concernsTop:"âš ï¸ Top concerns (academic, emotional, or behavior):",

        hTop:"ğŸ¯ Top 1â€“3 focus areas (write here):",
        hSub:"Over the next 6â€“8 weeks, our family will focus on:",
        supportNeeded:"ğŸ¤ Support we need from school / D.E.Bs:",
        signature:"âœğŸ½ Parent/Guardian Signature:",
        signaturePh:"Type your name",
        signDate:"ğŸ“… Date:",

        saveBtn:"ğŸ’¾ Save Student Snapshot",

        alertMissing:"Please enter Student Name and Grade before saving.",
        alertSaved:"Saved âœ… Sendingâ€¦",
      },

      es: {
        langLabel:"Idioma",
        title:"Resumen de Medio AÃ±o del Estudiante",
        subtitle:"Parent Power Circle â€¢ D.E.Bs Learning Academy",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ InformaciÃ³n del Estudiante",
        secB:"ğŸ˜ŠğŸ« CÃ³mo se Siente la Escuela Ahora",
        secC:"ğŸ“Šâœï¸ Resumen AcadÃ©mico RÃ¡pido",
        secD:"ğŸ¯ğŸ§  Conducta, Enfoque y OrganizaciÃ³n",
        secE:"ğŸŒŸğŸ† Fortalezas y Logros",
        secF:"âš ï¸ğŸ˜£ DesafÃ­os y Preocupaciones",
        secG:"â“ğŸ—£ï¸ Preguntas para la Escuela / Maestra(o)",
        secH:"ğŸ¯ğŸ“… Prioridades para las PrÃ³ximas 6â€“8 Semanas",

        studentName:"Nombre del estudiante:",
        grade:"Grado:",
        school:"Escuela:",
        teacher:"Maestro(a) principal:",
        todayDate:"Fecha de hoy:",
        term:"PerÃ­odo (trimestre):",
        termPh:"p. ej., OtoÃ±o 2025",

        b1:"Â¿CÃ³mo parece sentirse mi hijo/a sobre la escuela en general? (marca todas las que correspondan)",
        b2:"Â¿CÃ³mo me siento yo con este aÃ±o escolar hasta ahora?",
        yearSummaryLabel:"ğŸ“ En una o dos oraciones, describe este aÃ±o escolar hasta ahora:",
        yearSummaryPh:"Ejemplo: Las calificaciones se ven bien, pero la tarea se volviÃ³ una batalla y la confianza estÃ¡ bajando.",

        feel_excited:"ğŸ˜ Emocionado/a la mayorÃ­a de los dÃ­as",
        feel_fine:"ğŸ˜ Bien / es solo la escuela",
        feel_anxious:"ğŸ˜Ÿ Ansioso/a / nervioso/a",
        feel_bored:"ğŸ˜´ Aburrido/a / sin motivaciÃ³n",
        feel_overwhelmed:"ğŸ˜£ Abrumado/a / frustrado/a",
        feel_not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ No estoy seguro/a / seÃ±ales mixtas",

        year_calm:"ğŸ˜Œ Mayormente tranquilo/a y con confianza",
        year_worried:"ğŸ˜¬ PreocupaciÃ³n silenciosa",
        year_stressed:"ğŸ˜° Muy estresado/a y sin saber quÃ© hacer",
        year_mixed:"ğŸ­ Mixtoâ€”algunas cosas van muy bien, otras no",

        cHint:"ğŸ“Œ Usa la boleta de calificaciones, el portal o comentarios del maestro para completar esto.",
        cSubject:"Materia",
        cGradeLevel:"Nivel / CalificaciÃ³n",
        cHowIFeel:"CÃ³mo me siento",
        cTeacherNotes:"Notas del maestro",
        cReading:"Lectura / ELA",
        cMath:"MatemÃ¡ticas",
        cScience:"Ciencias",
        cSocial:"Estudios sociales",
        otherSubjectPh:"Otra materia...",

        feel_confident:"Con confianza âœ…",
        feel_okay:"Bien ğŸ™‚",
        feel_concerned:"Preocupado/a ğŸ˜•",
        feel_notsure:"No estoy seguro/a ğŸ¤·ğŸ½â€â™€ï¸",

        dAtSchoolTitle:"ğŸ« En la escuela",
        dAtSchoolNote:"(comentarios / notas del maestro):",
        dAtHomeTitle:"ğŸ  En casa durante la tarea / estudio",

        sb_focused:"âœ… Usualmente enfocado/a",
        sb_reminders:"ğŸ” Necesita recordatorios / redirecciÃ³n",
        sb_rushes:"â© Se apresura",
        sb_notfinish:"ğŸ§© A menudo no termina",
        sb_calls:"ğŸ“ Notas de conducta / llamadas a casa",
        sb_noconcerns:"ğŸ‘ Sin preocupaciones mayores",

        hb_starts:"ğŸš€ Empieza por su cuenta",
        hb_reminders:"â° Necesita recordatorios pero lo hace",
        hb_tears:"ğŸ˜­ Peleas / lÃ¡grimas son comunes",
        hb_neg:"ğŸ’” Dice â€œsoy tonto/aâ€ o â€œno puedoâ€",
        hb_avoids:"ğŸ™ˆ Evita la tarea u oculta tareas",

        behaviorNotesLabel:"ğŸ—’ï¸ Notas:",
        strengthsAcademic:"ğŸ“š Fortalezas acadÃ©micas / aprendizaje:",
        strengthsPersonal:"ğŸ’› Fortalezas personales (carÃ¡cter, talentos, habilidades sociales):",
        wins:"ğŸ† Logros de este aÃ±o (grandes o pequeÃ±os):",
        concernsTop:"âš ï¸ Principales preocupaciones (acadÃ©micas, emocionales o conducta):",

        hTop:"ğŸ¯ 1â€“3 prioridades (escribe aquÃ­):",
        hSub:"En las prÃ³ximas 6â€“8 semanas, nuestra familia se enfocarÃ¡ en:",
        supportNeeded:"ğŸ¤ Apoyo que necesitamos de la escuela / D.E.Bs:",
        signature:"âœğŸ½ Firma del padre/madre/tutor:",
        signaturePh:"Escribe tu nombre",
        signDate:"ğŸ“… Fecha:",

        saveBtn:"ğŸ’¾ Guardar Resumen del Estudiante",

        alertMissing:"Por favor, escribe el nombre del estudiante y el grado antes de guardar.",
        alertSaved:"Guardado âœ… Enviandoâ€¦",
      },

      fr: {
        langLabel:"Langue",
        title:"AperÃ§u de Mi-AnnÃ©e de lâ€™Ã‰lÃ¨ve",
        subtitle:"Parent Power Circle â€¢ D.E.Bs Learning Academy",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ Infos Ã‰lÃ¨ve",
        secB:"ğŸ˜ŠğŸ« Ressenti de lâ€™Ã‰cole (Maintenant)",
        secC:"ğŸ“Šâœï¸ AperÃ§u AcadÃ©mique Rapide",
        secD:"ğŸ¯ğŸ§  Comportement, Concentration & Organisation",
        secE:"ğŸŒŸğŸ† Forces & RÃ©ussites",
        secF:"âš ï¸ğŸ˜£ DÃ©fis & InquiÃ©tudes",
        secG:"â“ğŸ—£ï¸ Questions pour lâ€™Ã‰cole / lâ€™Enseignant",
        secH:"ğŸ¯ğŸ“… PrioritÃ©s pour les 6â€“8 Prochaines Semaines",

        studentName:"Nom de lâ€™Ã©lÃ¨ve :",
        grade:"Classe / Niveau :",
        school:"Ã‰cole :",
        teacher:"Enseignant principal :",
        todayDate:"Date du jour :",
        term:"PÃ©riode (trimestre) :",
        termPh:"ex. Automne 2025",

        b1:"Comment mon enfant semble-t-il/elle se sentir par rapport Ã  lâ€™Ã©cole ? (cochez tout ce qui sâ€™applique)",
        b2:"Comment est-ce que je me sens par rapport Ã  cette annÃ©e scolaire ?",
        yearSummaryLabel:"ğŸ“ En une ou deux phrases, dÃ©crivez cette annÃ©e scolaire jusquâ€™ici :",
        yearSummaryPh:"Exemple : Les notes sont correctes, mais les devoirs sont devenus difficiles et la confiance baisse.",

        feel_excited:"ğŸ˜ Enthousiaste la plupart des jours",
        feel_fine:"ğŸ˜ Ã‡a va / Â« câ€™est lâ€™Ã©cole Â»",
        feel_anxious:"ğŸ˜Ÿ Anxieux(se) / nerveux(se)",
        feel_bored:"ğŸ˜´ EnnuyÃ©(e) / dÃ©motivÃ©(e)",
        feel_overwhelmed:"ğŸ˜£ DÃ©bordÃ©(e) / frustrÃ©(e)",
        feel_not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ Pas sÃ»r(e) / signaux mixtes",

        year_calm:"ğŸ˜Œ PlutÃ´t calme et confiant(e)",
        year_worried:"ğŸ˜¬ Inquiet(Ã¨te) en silence",
        year_stressed:"ğŸ˜° TrÃ¨s stressÃ©(e) et perdu(e)",
        year_mixed:"ğŸ­ MitigÃ©â€”certaines choses vont bien, dâ€™autres non",

        cHint:"ğŸ“Œ Utilisez le bulletin, le portail, ou les commentaires de lâ€™enseignant.",
        cSubject:"MatiÃ¨re",
        cGradeLevel:"Note / Niveau",
        cHowIFeel:"Ressenti",
        cTeacherNotes:"Notes de lâ€™enseignant",
        cReading:"Lecture / ELA",
        cMath:"Maths",
        cScience:"Sciences",
        cSocial:"Sciences sociales",
        otherSubjectPh:"Autre matiÃ¨re...",

        feel_confident:"Confiant(e) âœ…",
        feel_okay:"Ã‡a va ğŸ™‚",
        feel_concerned:"Inquiet(Ã¨te) ğŸ˜•",
        feel_notsure:"Pas sÃ»r(e) ğŸ¤·ğŸ½â€â™€ï¸",

        dAtSchoolTitle:"ğŸ« Ã€ lâ€™Ã©cole",
        dAtSchoolNote:"(commentaires / notes) :",
        dAtHomeTitle:"ğŸ  Ã€ la maison (devoirs / Ã©tude)",

        sb_focused:"âœ… Souvent concentrÃ©(e)",
        sb_reminders:"ğŸ” Besoin de rappels / recadrage",
        sb_rushes:"â© Va trop vite",
        sb_notfinish:"ğŸ§© Ne finit pas souvent",
        sb_calls:"ğŸ“ Notes / appels Ã  la maison",
        sb_noconcerns:"ğŸ‘ Aucune inquiÃ©tude majeure",

        hb_starts:"ğŸš€ Commence seul(e)",
        hb_reminders:"â° Besoin de rappels mais le fait",
        hb_tears:"ğŸ˜­ Conflits / larmes frÃ©quents",
        hb_neg:"ğŸ’” Dit Â« je suis nul(le) Â» / Â« je nâ€™y arrive pas Â»",
        hb_avoids:"ğŸ™ˆ Ã‰vite les devoirs / cache des tÃ¢ches",

        behaviorNotesLabel:"ğŸ—’ï¸ Notes :",
        strengthsAcademic:"ğŸ“š Forces acadÃ©miques :",
        strengthsPersonal:"ğŸ’› Forces personnelles (caractÃ¨re, talents, social) :",
        wins:"ğŸ† RÃ©ussites (grandes ou petites) :",
        concernsTop:"âš ï¸ Principales inquiÃ©tudes (acadÃ©mique, Ã©motionnel, comportement) :",

        hTop:"ğŸ¯ 1â€“3 prioritÃ©s (Ã©crire ici) :",
        hSub:"Au cours des 6â€“8 prochaines semaines, notre famille se concentre sur :",
        supportNeeded:"ğŸ¤ Soutien nÃ©cessaire de lâ€™Ã©cole / D.E.Bs :",
        signature:"âœğŸ½ Signature parent/tuteur :",
        signaturePh:"Tapez votre nom",
        signDate:"ğŸ“… Date :",

        saveBtn:"ğŸ’¾ Enregistrer lâ€™aperÃ§u",

        alertMissing:"Veuillez saisir le nom de lâ€™Ã©lÃ¨ve et la classe avant dâ€™enregistrer.",
        alertSaved:"EnregistrÃ© âœ… Envoiâ€¦",
      },

      zh: {
        langLabel:"è¯­è¨€",
        title:"å­¦å¹´ä¸­æœŸå­¦ç”Ÿå¿«ç…§",
        subtitle:"Parent Power Circle â€¢ D.E.Bs Learning Academy",

        secA:"ğŸ‘§ğŸ½ğŸ“˜ å­¦ç”Ÿä¿¡æ¯",
        secB:"ğŸ˜ŠğŸ« ç›®å‰çš„ä¸Šå­¦æ„Ÿå—",
        secC:"ğŸ“Šâœï¸ å­¦ä¸šå¿«é€Ÿæ¦‚è§ˆ",
        secD:"ğŸ¯ğŸ§  è¡Œä¸ºã€ä¸“æ³¨ä¸ç»„ç»‡",
        secE:"ğŸŒŸğŸ† ä¼˜åŠ¿ä¸æˆæœ",
        secF:"âš ï¸ğŸ˜£ æŒ‘æˆ˜ä¸æ‹…å¿§",
        secG:"â“ğŸ—£ï¸ ç»™å­¦æ ¡/è€å¸ˆçš„é—®é¢˜",
        secH:"ğŸ¯ğŸ“… æœªæ¥6â€“8å‘¨çš„ä¼˜å…ˆé‡ç‚¹",

        studentName:"å­¦ç”Ÿå§“åï¼š",
        grade:"å¹´çº§ï¼š",
        school:"å­¦æ ¡ï¼š",
        teacher:"ç­ä¸»ä»»/ä¸»è¦è€å¸ˆï¼š",
        todayDate:"ä»Šå¤©æ—¥æœŸï¼š",
        term:"å­¦æœŸ/é˜¶æ®µï¼š",
        termPh:"ä¾‹å¦‚ï¼š2025å¹´ç§‹å­£",

        b1:"å­©å­æ€»ä½“å¯¹å­¦æ ¡çš„æ„Ÿè§‰å¦‚ä½•ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰",
        b2:"æˆ‘å¯¹ç›®å‰è¿™ä¸ªå­¦å¹´çš„æ„Ÿè§‰æ˜¯ï¼Ÿ",
        yearSummaryLabel:"ğŸ“ ç”¨ä¸€ä¸¤å¥è¯æè¿°ç›®å‰è¿™ä¸ªå­¦å¹´ï¼š",
        yearSummaryPh:"ä¾‹ï¼šæˆç»©çœ‹èµ·æ¥è¿˜è¡Œï¼Œä½†ä½œä¸šæ—¶é—´å˜å¾—å¾ˆéš¾ï¼Œä¿¡å¿ƒåœ¨ä¸‹é™ã€‚",

        feel_excited:"ğŸ˜ å¤§å¤šæ•°æ—¶å€™å¾ˆæœŸå¾…",
        feel_fine:"ğŸ˜ è¿˜å¥½/å°±æ˜¯ä¸Šå­¦",
        feel_anxious:"ğŸ˜Ÿ ç„¦è™‘/ç´§å¼ ",
        feel_bored:"ğŸ˜´ æ— èŠ/ç¼ºä¹åŠ¨åŠ›",
        feel_overwhelmed:"ğŸ˜£ å‹åŠ›å¤§/æ²®ä¸§",
        feel_not_sure:"ğŸ¤·ğŸ½â€â™€ï¸ ä¸ç¡®å®š/ä¿¡å·æ··æ‚",

        year_calm:"ğŸ˜Œ åŸºæœ¬å†·é™ä¸”æœ‰ä¿¡å¿ƒ",
        year_worried:"ğŸ˜¬ æš—è‡ªæ‹…å¿ƒ",
        year_stressed:"ğŸ˜° å¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠ",
        year_mixed:"ğŸ­ å¤æ‚â€”æœ‰äº›å¾ˆå¥½ï¼Œæœ‰äº›ä¸å¤ªè¡Œ",

        cHint:"ğŸ“Œ è¯·å‚è€ƒæˆç»©å•ã€å®¶é•¿å¹³å°æˆ–è€å¸ˆåé¦ˆå¡«å†™ã€‚",
        cSubject:"ç§‘ç›®",
        cGradeLevel:"æˆç»©/æ°´å¹³",
        cHowIFeel:"æˆ‘çš„æ„Ÿå—",
        cTeacherNotes:"è€å¸ˆå¤‡æ³¨",
        cReading:"é˜…è¯»/è‹±è¯­(ELA)",
        cMath:"æ•°å­¦",
        cScience:"ç§‘å­¦",
        cSocial:"ç¤¾ä¼šå­¦ç§‘",
        otherSubjectPh:"å…¶ä»–ç§‘ç›®â€¦",

        feel_confident:"æœ‰ä¿¡å¿ƒ âœ…",
        feel_okay:"è¿˜å¯ä»¥ ğŸ™‚",
        feel_concerned:"æ‹…å¿ƒ ğŸ˜•",
        feel_notsure:"ä¸ç¡®å®š ğŸ¤·ğŸ½â€â™€ï¸",

        dAtSchoolTitle:"ğŸ« åœ¨å­¦æ ¡",
        dAtSchoolNote:"ï¼ˆè€å¸ˆå¤‡æ³¨/åé¦ˆï¼‰ï¼š",
        dAtHomeTitle:"ğŸ  åœ¨å®¶å†™ä½œä¸š/å­¦ä¹ æ—¶",

        sb_focused:"âœ… é€šå¸¸ä¸“æ³¨",
        sb_reminders:"ğŸ” éœ€è¦æé†’/çº æ­£",
        sb_rushes:"â© åšé¢˜å¤ªå¿«",
        sb_notfinish:"ğŸ§© ç»å¸¸åšä¸å®Œ",
        sb_calls:"ğŸ“ è¡Œä¸ºè®°å½•/æ‰“ç”µè¯å›å®¶",
        sb_noconcerns:"ğŸ‘ æ²¡æœ‰é‡å¤§é—®é¢˜",

        hb_starts:"ğŸš€ èƒ½è‡ªå·±å¼€å§‹",
        hb_reminders:"â° éœ€è¦æé†’ä½†èƒ½åš",
        hb_tears:"ğŸ˜­ äº‰æ‰§/å“­é—¹å¸¸è§",
        hb_neg:"ğŸ’” è¯´â€œæˆ‘å¾ˆç¬¨/æˆ‘ä¸è¡Œâ€",
        hb_avoids:"ğŸ™ˆ é€ƒé¿ä½œä¸š/è—ä½œä¸š",

        behaviorNotesLabel:"ğŸ—’ï¸ å¤‡æ³¨ï¼š",
        strengthsAcademic:"ğŸ“š å­¦ä¸š/å­¦ä¹ ä¼˜åŠ¿ï¼š",
        strengthsPersonal:"ğŸ’› ä¸ªäººä¼˜åŠ¿ï¼ˆå“æ ¼/æ‰è‰º/ç¤¾äº¤ï¼‰ï¼š",
        wins:"ğŸ† æœ¬å­¦å¹´çš„å°/å¤§æˆå°±ï¼š",
        concernsTop:"âš ï¸ ä¸»è¦æ‹…å¿§ï¼ˆå­¦ä¸š/æƒ…ç»ª/è¡Œä¸ºï¼‰ï¼š",

        hTop:"ğŸ¯ 1â€“3 ä¸ªé‡ç‚¹ï¼ˆå†™åœ¨è¿™é‡Œï¼‰ï¼š",
        hSub:"æœªæ¥6â€“8å‘¨ï¼Œæˆ‘ä»¬å®¶åº­å°†é‡ç‚¹å…³æ³¨ï¼š",
        supportNeeded:"ğŸ¤ éœ€è¦å­¦æ ¡/D.E.Bsæä¾›çš„æ”¯æŒï¼š",
        signature:"âœğŸ½ å®¶é•¿/ç›‘æŠ¤äººç­¾åï¼š",
        signaturePh:"è¾“å…¥å§“å",
        signDate:"ğŸ“… æ—¥æœŸï¼š",

        saveBtn:"ğŸ’¾ ä¿å­˜å­¦ç”Ÿå¿«ç…§",

        alertMissing:"ä¿å­˜å‰è¯·å¡«å†™å­¦ç”Ÿå§“åå’Œå¹´çº§ã€‚",
        alertSaved:"å·²ä¿å­˜ âœ… æ­£åœ¨å‘é€â€¦",
      }
    };

    let currentLang = "en";

    function t(key){
      return (I18N[currentLang] && I18N[currentLang][key]) || (I18N.en[key]) || key;
    }

    function applyI18n(){
      document.documentElement.lang = currentLang;
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        el.innerHTML = t(el.dataset.i18n);
      });
      document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
        el.setAttribute("placeholder", t(el.dataset.i18nPlaceholder));
      });
      const langSel = document.getElementById("langSelect");
      if(langSel) langSel.value = currentLang;
    }

    // ================================
    // âœ… HELPERS
    // ================================
    const $ = (id) => document.getElementById(id);

    function getCheckedValues(name){
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(x=>x.value);
    }
    function getRadioValue(name){
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : "";
    }
    function setCheckedValues(name, values){
      const set = new Set(values || []);
      document.querySelectorAll(`input[name="${name}"]`).forEach(cb => cb.checked = set.has(cb.value));
    }
    function setRadioValue(name, value){
      document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = (r.value === value));
    }

    // ================================
    // âœ… FORM COLLECTION
    // ================================
    function collectForm(){
      return {
        _lang: currentLang,
        studentName: $("studentName").value.trim(),
        grade: $("grade").value.trim(),
        school: $("school").value.trim(),
        teacher: $("teacher").value.trim(),
        todayDate: $("todayDate").value,
        term: $("term").value.trim(),

        feelings: getCheckedValues("feelings"),
        yearFeel: getRadioValue("yearFeel"),
        yearSummary: $("yearSummary").value.trim(),

        academic: {
          reading: { grade: $("c_read_grade").value.trim(), feel: $("c_read_feel").value, notes: $("c_read_notes").value.trim() },
          math:    { grade: $("c_math_grade").value.trim(), feel: $("c_math_feel").value, notes: $("c_math_notes").value.trim() },
          science: { grade: $("c_sci_grade").value.trim(),  feel: $("c_sci_feel").value,  notes: $("c_sci_notes").value.trim() },
          social:  { grade: $("c_ss_grade").value.trim(),   feel: $("c_ss_feel").value,   notes: $("c_ss_notes").value.trim() },
          other1:  { name: $("c_other1_name").value.trim(), grade: $("c_other1_grade").value.trim(), feel: $("c_other1_feel").value, notes: $("c_other1_notes").value.trim() },
          other2:  { name: $("c_other2_name").value.trim(), grade: $("c_other2_grade").value.trim(), feel: $("c_other2_feel").value, notes: $("c_other2_notes").value.trim() },
        },

        schoolBeh: getCheckedValues("schoolBeh"),
        homeBeh: getCheckedValues("homeBeh"),
        behaviorNotes: $("behaviorNotes").value.trim(),

        strengthsAcademic: $("strengthsAcademic").value.trim(),
        strengthsPersonal: $("strengthsPersonal").value.trim(),
        wins: $("wins").value.trim(),

        concernsTop: $("concernsTop").value.trim(),

        questions: { q1: $("q1").value.trim(), q2: $("q2").value.trim(), q3: $("q3").value.trim() },

        priorityFocus: $("priorityFocus").value.trim(),
        supportNeeded: $("supportNeeded").value.trim(),

        signature: $("signature").value.trim(),
        signDate: $("signDate").value,

        _savedAt: new Date().toISOString()
      };
    }

    function applyForm(data){
      if(!data) return;
      $("studentName").value = data.studentName || "";
      $("grade").value = data.grade || "";
      $("school").value = data.school || "";
      $("teacher").value = data.teacher || "";
      $("todayDate").value = data.todayDate || "";
      $("term").value = data.term || "";

      setCheckedValues("feelings", data.feelings || []);
      setRadioValue("yearFeel", data.yearFeel || "");
      $("yearSummary").value = data.yearSummary || "";

      const a = data.academic || {};
      const r = a.reading || {};
      const m = a.math || {};
      const s = a.science || {};
      const so = a.social || {};
      const o1 = a.other1 || {};
      const o2 = a.other2 || {};

      $("c_read_grade").value = r.grade || "";
      $("c_read_feel").value = r.feel || "";
      $("c_read_notes").value = r.notes || "";

      $("c_math_grade").value = m.grade || "";
      $("c_math_feel").value = m.feel || "";
      $("c_math_notes").value = m.notes || "";

      $("c_sci_grade").value = s.grade || "";
      $("c_sci_feel").value = s.feel || "";
      $("c_sci_notes").value = s.notes || "";

      $("c_ss_grade").value = so.grade || "";
      $("c_ss_feel").value = so.feel || "";
      $("c_ss_notes").value = so.notes || "";

      $("c_other1_name").value = o1.name || "";
      $("c_other1_grade").value = o1.grade || "";
      $("c_other1_feel").value = o1.feel || "";
      $("c_other1_notes").value = o1.notes || "";

      $("c_other2_name").value = o2.name || "";
      $("c_other2_grade").value = o2.grade || "";
      $("c_other2_feel").value = o2.feel || "";
      $("c_other2_notes").value = o2.notes || "";

      setCheckedValues("schoolBeh", data.schoolBeh || []);
      setCheckedValues("homeBeh", data.homeBeh || []);
      $("behaviorNotes").value = data.behaviorNotes || "";

      $("strengthsAcademic").value = data.strengthsAcademic || "";
      $("strengthsPersonal").value = data.strengthsPersonal || "";
      $("wins").value = data.wins || "";

      $("concernsTop").value = data.concernsTop || "";

      const q = data.questions || {};
      $("q1").value = q.q1 || "";
      $("q2").value = q.q2 || "";
      $("q3").value = q.q3 || "";

      $("priorityFocus").value = data.priorityFocus || "";
      $("supportNeeded").value = data.supportNeeded || "";

      $("signature").value = data.signature || "";
      $("signDate").value = data.signDate || "";
    }

    // ================================
    // âœ… GOOGLE SHEETS POST (works on GitHub Pages)
    // ================================
    function flattenForLegacyColumns(data){
      const strengths = [
        data.strengthsAcademic && ("Academic Strengths: " + data.strengthsAcademic),
        data.strengthsPersonal && ("Personal Strengths: " + data.strengthsPersonal),
        data.wins && ("Wins: " + data.wins),
      ].filter(Boolean).join("\\n\\n");

      const behavior = [
        data.schoolBeh?.length ? ("At school: " + data.schoolBeh.join(", ")) : "",
        data.homeBeh?.length ? ("At home: " + data.homeBeh.join(", ")) : "",
        data.behaviorNotes ? ("Notes: " + data.behaviorNotes) : ""
      ].filter(Boolean).join("\\n");

      const additionalNotes = [
        data.questions?.q1 ? ("Q1: " + data.questions.q1) : "",
        data.questions?.q2 ? ("Q2: " + data.questions.q2) : "",
        data.questions?.q3 ? ("Q3: " + data.questions.q3) : "",
        data.priorityFocus ? ("Priority Focus: " + data.priorityFocus) : "",
        data.supportNeeded ? ("Support Needed: " + data.supportNeeded) : "",
        data.signature ? ("Signature: " + data.signature) : "",
        data.signDate ? ("Signed Date: " + data.signDate) : ""
      ].filter(Boolean).join("\\n\\n");

      return { strengths, behavior, additionalNotes };
    }

    async function sendToGoogleSheet(data){
      const legacy = flattenForLegacyColumns(data);
      const body = new URLSearchParams();

      // Your current Apps Script columns (legacy)
      body.append("studentName", data.studentName || "");
      body.append("grade", data.grade || "");
      body.append("school", data.school || "");
      body.append("teacher", data.teacher || "");
      body.append("period", data.term || "");
      body.append("date", data.todayDate || data.signDate || "");
      body.append("yearDescription", data.yearSummary || "");
      body.append("strengths", legacy.strengths || "");
      body.append("concerns", data.concernsTop || "");
      body.append("attendance", ""); // not in current form
      body.append("behavior", legacy.behavior || "");
      body.append("parentComments", data.yearFeel || "");
      body.append("additionalNotes", legacy.additionalNotes || "");

      // Full JSON payload (optional if you later update Apps Script to store it)
      body.append("payload", JSON.stringify(data));

      await fetch(SHEETS_WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
        body: body.toString(),
      });
    }

    // ================================
    // âœ… SAVE â†’ SHEETS â†’ CONFIRMATION
    // ================================
    async function saveSnapshotAndGo(){
      const data = collectForm();

      if(!data.studentName || !data.grade){
        alert(t("alertMissing"));
        return;
      }

      // Save on the device first (so confirmation always has it)
      localStorage.setItem(STORAGE_SNAPSHOT_KEY, JSON.stringify(data));
      localStorage.setItem(STORAGE_DRAFT_KEY, JSON.stringify(data));
      localStorage.setItem(STORAGE_LANG_KEY, currentLang);

      const btn = $("btnSaveSnapshot");
      if(btn){
        btn.disabled = true;
        btn.textContent = t("alertSaved") + " â³";
      }

      try { await sendToGoogleSheet(data); } catch (e) { console.error(e); }

      // Go to confirmation page (no huge URL needed)
      window.location.href = `confirmation.html?lang=${encodeURIComponent(currentLang)}`;
    }

    // ================================
    // âœ… INIT
    // ================================
    function initLang(){
      const urlLang = new URLSearchParams(window.location.search).get("lang");
      const stored = localStorage.getItem(STORAGE_LANG_KEY);
      currentLang = urlLang || stored || "en";
      if(!I18N[currentLang]) currentLang = "en";
      applyI18n();
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      initLang();

      const langSel = $("langSelect");
      if(langSel){
        langSel.addEventListener("change", ()=>{
          currentLang = langSel.value;
          localStorage.setItem(STORAGE_LANG_KEY, currentLang);
          applyI18n();
        });
      }

      // Auto-load last draft on this device (silent)
      const raw = localStorage.getItem(STORAGE_DRAFT_KEY);
      if(raw){
        try { applyForm(JSON.parse(raw)); } catch {}
      }

      $("btnSaveSnapshot").addEventListener("click", saveSnapshotAndGo);
    });
  </script>
</body>
</html>